{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.interopDefault = interopDefault;\nexports.loadDefaultErrorComponents = loadDefaultErrorComponents;\nexports.loadComponents = loadComponents;\n\nvar _constants = require(\"../shared/lib/constants\");\n\nvar _path = require(\"path\");\n\nvar _require = require(\"./require\");\n\nfunction interopDefault(mod) {\n  return mod.default || mod;\n}\n\nasync function loadDefaultErrorComponents(distDir) {\n  const Document1 = interopDefault(require('next/dist/pages/_document'));\n  const App = interopDefault(require('next/dist/pages/_app'));\n\n  const ComponentMod = require('next/dist/pages/_error');\n\n  const Component = interopDefault(ComponentMod);\n  return {\n    App,\n    Document: Document1,\n    Component,\n    buildManifest: require((0, _path).join(distDir, `fallback-${_constants.BUILD_MANIFEST}`)),\n    reactLoadableManifest: {},\n    ComponentMod\n  };\n}\n\nasync function loadComponents(distDir, pathname, serverless) {\n  if (serverless) {\n    const Component = await (0, _require).requirePage(pathname, distDir, serverless);\n    let {\n      getStaticProps,\n      getStaticPaths,\n      getServerSideProps\n    } = Component;\n    getStaticProps = await getStaticProps;\n    getStaticPaths = await getStaticPaths;\n    getServerSideProps = await getServerSideProps;\n    const pageConfig = (await Component.config) || {};\n    return {\n      Component,\n      pageConfig,\n      getStaticProps,\n      getStaticPaths,\n      getServerSideProps,\n      ComponentMod: Component\n    };\n  }\n\n  const DocumentMod = await (0, _require).requirePage('/_document', distDir, serverless);\n  const AppMod = await (0, _require).requirePage('/_app', distDir, serverless);\n  const ComponentMod = await (0, _require).requirePage(pathname, distDir, serverless);\n  const [buildManifest, reactLoadableManifest, Component, Document1, App] = await Promise.all([require((0, _path).join(distDir, _constants.BUILD_MANIFEST)), require((0, _path).join(distDir, _constants.REACT_LOADABLE_MANIFEST)), interopDefault(ComponentMod), interopDefault(DocumentMod), interopDefault(AppMod)]);\n  const {\n    getServerSideProps,\n    getStaticProps,\n    getStaticPaths\n  } = ComponentMod;\n  return {\n    App,\n    Document: Document1,\n    Component,\n    buildManifest,\n    reactLoadableManifest,\n    pageConfig: ComponentMod.config || {},\n    ComponentMod,\n    getServerSideProps,\n    getStaticProps,\n    getStaticPaths\n  };\n}","map":{"version":3,"sources":["../../server/load-components.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  BUILD_MANIFEST,\n  REACT_LOADABLE_MANIFEST,\n} from '../shared/lib/constants'\nimport { join } from 'path'\nimport { requirePage } from './require'\nimport { BuildManifest } from './get-page-files'\nimport { AppType, DocumentType } from '../shared/lib/utils'\nimport {\n  PageConfig,\n  GetStaticPaths,\n  GetServerSideProps,\n  GetStaticProps,\n} from 'next/types'\n\nexport function interopDefault(mod: any) {\n  return mod.default || mod\n}\n\nexport type ManifestItem = {\n  id: number | string\n  files: string[]\n}\n\ntype ReactLoadableManifest = { [moduleId: string]: ManifestItem }\n\nexport type LoadComponentsReturnType = {\n  Component: React.ComponentType\n  pageConfig?: PageConfig\n  buildManifest: BuildManifest\n  reactLoadableManifest: ReactLoadableManifest\n  Document: DocumentType\n  App: AppType\n  getStaticProps?: GetStaticProps\n  getStaticPaths?: GetStaticPaths\n  getServerSideProps?: GetServerSideProps\n  ComponentMod: any\n}\n\nexport async function loadDefaultErrorComponents(distDir: string) {\n  const Document = interopDefault(require('next/dist/pages/_document'))\n  const App = interopDefault(require('next/dist/pages/_app'))\n  const ComponentMod = require('next/dist/pages/_error')\n  const Component = interopDefault(ComponentMod)\n\n  return {\n    App,\n    Document,\n    Component,\n    buildManifest: require(join(distDir, `fallback-${BUILD_MANIFEST}`)),\n    reactLoadableManifest: {},\n    ComponentMod,\n  }\n}\n\nexport async function loadComponents(\n  distDir: string,\n  pathname: string,\n  serverless: boolean\n): Promise<LoadComponentsReturnType> {\n  if (serverless) {\n    const Component = await requirePage(pathname, distDir, serverless)\n    let { getStaticProps, getStaticPaths, getServerSideProps } = Component\n\n    getStaticProps = await getStaticProps\n    getStaticPaths = await getStaticPaths\n    getServerSideProps = await getServerSideProps\n    const pageConfig = (await Component.config) || {}\n\n    return {\n      Component,\n      pageConfig,\n      getStaticProps,\n      getStaticPaths,\n      getServerSideProps,\n      ComponentMod: Component,\n    } as LoadComponentsReturnType\n  }\n\n  const DocumentMod = await requirePage('/_document', distDir, serverless)\n  const AppMod = await requirePage('/_app', distDir, serverless)\n  const ComponentMod = await requirePage(pathname, distDir, serverless)\n\n  const [buildManifest, reactLoadableManifest, Component, Document, App] =\n    await Promise.all([\n      require(join(distDir, BUILD_MANIFEST)),\n      require(join(distDir, REACT_LOADABLE_MANIFEST)),\n      interopDefault(ComponentMod),\n      interopDefault(DocumentMod),\n      interopDefault(AppMod),\n    ])\n\n  const { getServerSideProps, getStaticProps, getStaticPaths } = ComponentMod\n\n  return {\n    App,\n    Document,\n    Component,\n    buildManifest,\n    reactLoadableManifest,\n    pageConfig: ComponentMod.config || {},\n    ComponentMod,\n    getServerSideProps,\n    getStaticProps,\n    getStaticPaths,\n  }\n}\n"]},"metadata":{},"sourceType":"script"}