{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.attachReactRefresh = attachReactRefresh;\nexports.default = getBaseWebpackConfig;\n\nvar _reactRefreshWebpackPlugin = _interopRequireDefault(require(\"@next/react-refresh-utils/ReactRefreshWebpackPlugin\"));\n\nvar _chalk = _interopRequireDefault(require(\"chalk\"));\n\nvar _crypto = _interopRequireDefault(require(\"crypto\"));\n\nvar _fs = require(\"fs\");\n\nvar _codeFrame = require(\"next/dist/compiled/babel/code-frame\");\n\nvar _semver = _interopRequireDefault(require(\"next/dist/compiled/semver\"));\n\nvar _webpack = require(\"next/dist/compiled/webpack/webpack\");\n\nvar _path = _interopRequireWildcard(require(\"path\"));\n\nvar _constants = require(\"../lib/constants\");\n\nvar _fileExists = require(\"../lib/file-exists\");\n\nvar _getPackageVersion = require(\"../lib/get-package-version\");\n\nvar _getTypeScriptConfiguration = require(\"../lib/typescript/getTypeScriptConfiguration\");\n\nvar _constants1 = require(\"../shared/lib/constants\");\n\nvar _utils = require(\"../shared/lib/utils\");\n\nvar Log = _interopRequireWildcard(require(\"./output/log\"));\n\nvar _config = require(\"./webpack/config\");\n\nvar _overrideCssConfiguration = require(\"./webpack/config/blocks/css/overrideCssConfiguration\");\n\nvar _buildManifestPlugin = _interopRequireDefault(require(\"./webpack/plugins/build-manifest-plugin\"));\n\nvar _buildStatsPlugin = _interopRequireDefault(require(\"./webpack/plugins/build-stats-plugin\"));\n\nvar _chunkNamesPlugin = _interopRequireDefault(require(\"./webpack/plugins/chunk-names-plugin\"));\n\nvar _jsconfigPathsPlugin = require(\"./webpack/plugins/jsconfig-paths-plugin\");\n\nvar _nextDropClientPagePlugin = require(\"./webpack/plugins/next-drop-client-page-plugin\");\n\nvar _nextTraceEntrypointsPlugin = require(\"./webpack/plugins/next-trace-entrypoints-plugin\");\n\nvar _nextjsSsrImport = _interopRequireDefault(require(\"./webpack/plugins/nextjs-ssr-import\"));\n\nvar _nextjsSsrModuleCache = _interopRequireDefault(require(\"./webpack/plugins/nextjs-ssr-module-cache\"));\n\nvar _pagesManifestPlugin = _interopRequireDefault(require(\"./webpack/plugins/pages-manifest-plugin\"));\n\nvar _profilingPlugin = require(\"./webpack/plugins/profiling-plugin\");\n\nvar _reactLoadablePlugin = require(\"./webpack/plugins/react-loadable-plugin\");\n\nvar _serverlessPlugin = require(\"./webpack/plugins/serverless-plugin\");\n\nvar _webpackConformancePlugin = _interopRequireWildcard(require(\"./webpack/plugins/webpack-conformance-plugin\"));\n\nvar _wellknownErrorsPlugin = require(\"./webpack/plugins/wellknown-errors-plugin\");\n\nvar _css = require(\"./webpack/config/blocks/css\");\n\nvar _copyFilePlugin = require(\"./webpack/plugins/copy-file-plugin\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\n          var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {};\n\n          if (desc.get || desc.set) {\n            Object.defineProperty(newObj, key, desc);\n          } else {\n            newObj[key] = obj[key];\n          }\n        }\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nconst devtoolRevertWarning = (0, _utils).execOnce(devtool => {\n  console.warn(_chalk.default.yellow.bold('Warning: ') + _chalk.default.bold(`Reverting webpack devtool to '${devtool}'.\\n`) + 'Changing the webpack devtool in development mode will cause severe performance regressions.\\n' + 'Read more: https://nextjs.org/docs/messages/improper-devtool');\n});\n\nfunction parseJsonFile(filePath) {\n  const JSON5 = require('next/dist/compiled/json5');\n\n  const contents = (0, _fs).readFileSync(filePath, 'utf8'); // Special case an empty file\n\n  if (contents.trim() === '') {\n    return {};\n  }\n\n  try {\n    return JSON5.parse(contents);\n  } catch (err) {\n    const codeFrame = (0, _codeFrame).codeFrameColumns(String(contents), {\n      start: {\n        line: err.lineNumber,\n        column: err.columnNumber\n      }\n    }, {\n      message: err.message,\n      highlightCode: true\n    });\n    throw new Error(`Failed to parse \"${filePath}\":\\n${codeFrame}`);\n  }\n}\n\nfunction getOptimizedAliases(isServer) {\n  if (isServer) {\n    return {};\n  }\n\n  const stubWindowFetch = _path.default.join(__dirname, 'polyfills', 'fetch', 'index.js');\n\n  const stubObjectAssign = _path.default.join(__dirname, 'polyfills', 'object-assign.js');\n\n  const shimAssign = _path.default.join(__dirname, 'polyfills', 'object.assign');\n\n  return Object.assign({}, {\n    unfetch$: stubWindowFetch,\n    'isomorphic-unfetch$': stubWindowFetch,\n    'whatwg-fetch$': _path.default.join(__dirname, 'polyfills', 'fetch', 'whatwg-fetch.js')\n  }, {\n    'object-assign$': stubObjectAssign,\n    // Stub Package: object.assign\n    'object.assign/auto': _path.default.join(shimAssign, 'auto.js'),\n    'object.assign/implementation': _path.default.join(shimAssign, 'implementation.js'),\n    'object.assign$': _path.default.join(shimAssign, 'index.js'),\n    'object.assign/polyfill': _path.default.join(shimAssign, 'polyfill.js'),\n    'object.assign/shim': _path.default.join(shimAssign, 'shim.js'),\n    // Replace: full URL polyfill with platform-based polyfill\n    url: require.resolve('native-url')\n  });\n}\n\nfunction attachReactRefresh(webpackConfig, targetLoader) {\n  var ref;\n  let injections = 0;\n  const reactRefreshLoaderName = '@next/react-refresh-utils/loader';\n\n  const reactRefreshLoader = require.resolve(reactRefreshLoaderName);\n\n  (ref = webpackConfig.module) === null || ref === void 0 ? void 0 : ref.rules.forEach(rule => {\n    const curr = rule.use; // When the user has configured `defaultLoaders.babel` for a input file:\n\n    if (curr === targetLoader) {\n      ++injections;\n      rule.use = [reactRefreshLoader, curr];\n    } else if (Array.isArray(curr) && curr.some(r => r === targetLoader) && // Check if loader already exists:\n    !curr.some(r => r === reactRefreshLoader || r === reactRefreshLoaderName)) {\n      ++injections;\n      const idx = curr.findIndex(r => r === targetLoader); // Clone to not mutate user input\n\n      rule.use = [...curr]; // inject / input: [other, babel] output: [other, refresh, babel]:\n\n      rule.use.splice(idx, 0, reactRefreshLoader);\n    }\n  });\n\n  if (injections) {\n    Log.info(`automatically enabled Fast Refresh for ${injections} custom loader${injections > 1 ? 's' : ''}`);\n  }\n}\n\nconst WEBPACK_RESOLVE_OPTIONS = {\n  // This always uses commonjs resolving, assuming API is identical\n  // between ESM and CJS in a package\n  // Otherwise combined ESM+CJS packages will never be external\n  // as resolving mismatch would lead to opt-out from being external.\n  dependencyType: 'commonjs',\n  symlinks: true\n};\nconst WEBPACK_ESM_RESOLVE_OPTIONS = {\n  dependencyType: 'esm',\n  symlinks: true\n};\nconst NODE_RESOLVE_OPTIONS = {\n  dependencyType: 'commonjs',\n  modules: ['node_modules'],\n  alias: false,\n  fallback: false,\n  exportsFields: ['exports'],\n  importsFields: ['imports'],\n  conditionNames: ['node', 'require', 'module'],\n  descriptionFiles: ['package.json'],\n  extensions: ['.js', '.json', '.node'],\n  enforceExtensions: false,\n  symlinks: true,\n  mainFields: ['main'],\n  mainFiles: ['index'],\n  roots: [],\n  fullySpecified: false,\n  preferRelative: false,\n  preferAbsolute: false,\n  restrictions: []\n};\nconst NODE_ESM_RESOLVE_OPTIONS = { ...NODE_RESOLVE_OPTIONS,\n  dependencyType: 'esm',\n  conditionNames: ['node', 'import', 'module'],\n  fullySpecified: true\n};\n\nasync function getBaseWebpackConfig(dir, {\n  buildId,\n  config,\n  dev = false,\n  isServer = false,\n  pagesDir,\n  target = 'server',\n  reactProductionProfiling = false,\n  entrypoints,\n  rewrites,\n  isDevFallback = false,\n  runWebpackSpan\n}) {\n  var ref, ref1, ref2, ref3, ref4, ref5, ref6, ref7, ref8, ref9;\n  const hasRewrites = rewrites.beforeFiles.length > 0 || rewrites.afterFiles.length > 0 || rewrites.fallback.length > 0;\n  const hasReactRefresh = dev && !isServer;\n  const reactDomVersion = await (0, _getPackageVersion).getPackageVersion({\n    cwd: dir,\n    name: 'react-dom'\n  });\n  const hasReact18 = Boolean(reactDomVersion) && (_semver.default.gte(reactDomVersion, '18.0.0') || ((ref = _semver.default.coerce(reactDomVersion)) === null || ref === void 0 ? void 0 : ref.version) === '18.0.0');\n  const hasReactPrerelease = Boolean(reactDomVersion) && _semver.default.prerelease(reactDomVersion) != null;\n  const hasReactRoot = config.experimental.reactRoot || hasReact18; // Only inform during one of the builds\n\n  if (!isServer) {\n    if (hasReactRoot) {\n      Log.info('Using the createRoot API for React');\n    }\n\n    if (hasReactPrerelease) {\n      Log.warn(`You are using an unsupported prerelease of 'react-dom' which may cause ` + `unexpected or broken application behavior. Continue at your own risk.`);\n    }\n  }\n\n  const babelConfigFile = await ['.babelrc', '.babelrc.json', '.babelrc.js', '.babelrc.mjs', '.babelrc.cjs', 'babel.config.js', 'babel.config.json', 'babel.config.mjs', 'babel.config.cjs'].reduce(async (memo, filename) => {\n    const configFilePath = _path.default.join(dir, filename);\n\n    return (await memo) || ((await (0, _fileExists).fileExists(configFilePath)) ? configFilePath : undefined);\n  }, Promise.resolve(undefined));\n\n  const distDir = _path.default.join(dir, config.distDir); // Webpack 5 can use the faster babel loader, webpack 5 has built-in caching for loaders\n  // For webpack 4 the old loader is used as it has external caching\n\n\n  const babelLoader = _webpack.isWebpack5 ? require.resolve('./babel/loader/index') : 'next-babel-loader';\n  const useSWCLoader = config.experimental.swcLoader && _webpack.isWebpack5;\n\n  if (useSWCLoader && babelConfigFile) {\n    Log.warn(`experimental.swcLoader enabled. The custom Babel configuration will not be used.`);\n  }\n\n  const defaultLoaders = {\n    babel: useSWCLoader ? {\n      loader: 'next-swc-loader',\n      options: {\n        isServer\n      }\n    } : {\n      loader: babelLoader,\n      options: {\n        configFile: babelConfigFile,\n        isServer,\n        distDir,\n        pagesDir,\n        cwd: dir,\n        // Webpack 5 has a built-in loader cache\n        cache: !_webpack.isWebpack5,\n        development: dev,\n        hasReactRefresh,\n        hasJsxRuntime: true\n      }\n    },\n    // Backwards compat\n    hotSelfAccept: {\n      loader: 'noop-loader'\n    }\n  };\n  const babelIncludeRegexes = [/next[\\\\/]dist[\\\\/]shared[\\\\/]lib/, /next[\\\\/]dist[\\\\/]client/, /next[\\\\/]dist[\\\\/]pages/, /[\\\\/](strip-ansi|ansi-regex)[\\\\/]/]; // Support for NODE_PATH\n\n  const nodePathList = (process.env.NODE_PATH || '').split(process.platform === 'win32' ? ';' : ':').filter(p => !!p);\n  const isServerless = target === 'serverless';\n  const isServerlessTrace = target === 'experimental-serverless-trace'; // Intentionally not using isTargetLikeServerless helper\n\n  const isLikeServerless = isServerless || isServerlessTrace;\n  const outputDir = isLikeServerless ? _constants1.SERVERLESS_DIRECTORY : _constants1.SERVER_DIRECTORY;\n\n  const outputPath = _path.default.join(distDir, isServer ? outputDir : '');\n\n  const totalPages = Object.keys(entrypoints).length;\n  const clientEntries = !isServer ? {\n    // Backwards compatibility\n    'main.js': [],\n    ...(dev ? {\n      [_constants1.CLIENT_STATIC_FILES_RUNTIME_REACT_REFRESH]: require.resolve(`@next/react-refresh-utils/runtime`),\n      [_constants1.CLIENT_STATIC_FILES_RUNTIME_AMP]: `./` + (0, _path).relative(dir, (0, _path).join(_constants.NEXT_PROJECT_ROOT_DIST_CLIENT, 'dev', 'amp-dev')).replace(/\\\\/g, '/')\n    } : {}),\n    [_constants1.CLIENT_STATIC_FILES_RUNTIME_MAIN]: `./` + _path.default.relative(dir, _path.default.join(_constants.NEXT_PROJECT_ROOT_DIST_CLIENT, dev ? `next-dev.js` : 'next.js')).replace(/\\\\/g, '/')\n  } : undefined;\n  let typeScriptPath;\n\n  try {\n    typeScriptPath = require.resolve('typescript', {\n      paths: [dir]\n    });\n  } catch (_) {}\n\n  const tsConfigPath = _path.default.join(dir, 'tsconfig.json');\n\n  const useTypeScript = Boolean(typeScriptPath && (await (0, _fileExists).fileExists(tsConfigPath)));\n  let jsConfig; // jsconfig is a subset of tsconfig\n\n  if (useTypeScript) {\n    const ts = await Promise.resolve().then(function () {\n      return _interopRequireWildcard(require(typeScriptPath));\n    });\n    const tsConfig = await (0, _getTypeScriptConfiguration).getTypeScriptConfiguration(ts, tsConfigPath, true);\n    jsConfig = {\n      compilerOptions: tsConfig.options\n    };\n  }\n\n  const jsConfigPath = _path.default.join(dir, 'jsconfig.json');\n\n  if (!useTypeScript && (await (0, _fileExists).fileExists(jsConfigPath))) {\n    jsConfig = parseJsonFile(jsConfigPath);\n  }\n\n  let resolvedBaseUrl;\n\n  if (jsConfig === null || jsConfig === void 0 ? void 0 : (ref1 = jsConfig.compilerOptions) === null || ref1 === void 0 ? void 0 : ref1.baseUrl) {\n    resolvedBaseUrl = _path.default.resolve(dir, jsConfig.compilerOptions.baseUrl);\n  }\n\n  function getReactProfilingInProduction() {\n    if (reactProductionProfiling) {\n      return {\n        'react-dom$': 'react-dom/profiling',\n        'scheduler/tracing': 'scheduler/tracing-profiling'\n      };\n    }\n  } // tell webpack where to look for _app and _document\n  // using aliases to allow falling back to the default\n  // version when removed or not present\n\n\n  const clientResolveRewrites = require.resolve('../shared/lib/router/utils/resolve-rewrites');\n\n  const clientResolveRewritesNoop = require.resolve('../shared/lib/router/utils/resolve-rewrites-noop');\n\n  const customAppAliases = {};\n  const customErrorAlias = {};\n  const customDocumentAliases = {};\n\n  if (dev && _webpack.isWebpack5) {\n    customAppAliases[`${_constants.PAGES_DIR_ALIAS}/_app`] = [...config.pageExtensions.reduce((prev, ext) => {\n      prev.push(_path.default.join(pagesDir, `_app.${ext}`));\n      return prev;\n    }, []), 'next/dist/pages/_app.js'];\n    customAppAliases[`${_constants.PAGES_DIR_ALIAS}/_error`] = [...config.pageExtensions.reduce((prev, ext) => {\n      prev.push(_path.default.join(pagesDir, `_error.${ext}`));\n      return prev;\n    }, []), 'next/dist/pages/_error.js'];\n    customDocumentAliases[`${_constants.PAGES_DIR_ALIAS}/_document`] = [...config.pageExtensions.reduce((prev, ext) => {\n      prev.push(_path.default.join(pagesDir, `_document.${ext}`));\n      return prev;\n    }, []), 'next/dist/pages/_document.js'];\n  }\n\n  const resolveConfig = {\n    // Disable .mjs for node_modules bundling\n    extensions: isServer ? ['.js', '.mjs', ...(useTypeScript ? ['.tsx', '.ts'] : []), '.jsx', '.json', '.wasm'] : ['.mjs', '.js', ...(useTypeScript ? ['.tsx', '.ts'] : []), '.jsx', '.json', '.wasm'],\n    modules: ['node_modules', ...nodePathList],\n    alias: {\n      next: _constants.NEXT_PROJECT_ROOT,\n      ...customAppAliases,\n      ...customErrorAlias,\n      ...customDocumentAliases,\n      [_constants.PAGES_DIR_ALIAS]: pagesDir,\n      [_constants.DOT_NEXT_ALIAS]: distDir,\n      ...getOptimizedAliases(isServer),\n      ...getReactProfilingInProduction(),\n      [clientResolveRewrites]: hasRewrites ? clientResolveRewrites : _webpack.isWebpack5 ? false : clientResolveRewritesNoop\n    },\n    ...(_webpack.isWebpack5 && !isServer ? {\n      // Full list of old polyfills is accessible here:\n      // https://github.com/webpack/webpack/blob/2a0536cf510768111a3a6dceeb14cb79b9f59273/lib/ModuleNotFoundError.js#L13-L42\n      fallback: {\n        assert: require.resolve('assert/'),\n        buffer: require.resolve('buffer/'),\n        constants: require.resolve('constants-browserify'),\n        crypto: require.resolve('crypto-browserify'),\n        domain: require.resolve('domain-browser'),\n        http: require.resolve('stream-http'),\n        https: require.resolve('https-browserify'),\n        os: require.resolve('os-browserify/browser'),\n        path: require.resolve('path-browserify'),\n        punycode: require.resolve('punycode'),\n        process: require.resolve('process/browser'),\n        // Handled in separate alias\n        querystring: require.resolve('querystring-es3'),\n        stream: require.resolve('stream-browserify'),\n        string_decoder: require.resolve('string_decoder'),\n        sys: require.resolve('util/'),\n        timers: require.resolve('timers-browserify'),\n        tty: require.resolve('tty-browserify'),\n        // Handled in separate alias\n        // url: require.resolve('url/'),\n        util: require.resolve('util/'),\n        vm: require.resolve('vm-browserify'),\n        zlib: require.resolve('browserify-zlib')\n      }\n    } : undefined),\n    mainFields: isServer ? ['main', 'module'] : ['browser', 'module', 'main'],\n    plugins: _webpack.isWebpack5 ? [] : [require('pnp-webpack-plugin')]\n  };\n  const terserOptions = {\n    parse: {\n      ecma: 8\n    },\n    compress: {\n      ecma: 5,\n      warnings: false,\n      // The following two options are known to break valid JavaScript code\n      comparisons: false,\n      inline: 2\n    },\n    mangle: {\n      safari10: true\n    },\n    output: {\n      ecma: 5,\n      safari10: true,\n      comments: false,\n      // Fixes usage of Emoji and certain Regex\n      ascii_only: true\n    }\n  };\n\n  const isModuleCSS = module => {\n    return (// mini-css-extract-plugin\n      module.type === `css/mini-extract` || // extract-css-chunks-webpack-plugin (old)\n      module.type === `css/extract-chunks` || // extract-css-chunks-webpack-plugin (new)\n      module.type === `css/extract-css-chunks`\n    );\n  }; // Contains various versions of the Webpack SplitChunksPlugin used in different build types\n\n\n  const splitChunksConfigs = {\n    dev: {\n      cacheGroups: {\n        default: false,\n        vendors: false\n      }\n    },\n    prodGranular: {\n      // Keep main and _app chunks unsplitted in webpack 5\n      // as we don't need a separate vendor chunk from that\n      // and all other chunk depend on them so there is no\n      // duplication that need to be pulled out.\n      chunks: _webpack.isWebpack5 ? chunk => !/^(polyfills|main|pages\\/_app)$/.test(chunk.name) : 'all',\n      cacheGroups: {\n        framework: {\n          chunks: 'all',\n          name: 'framework',\n          // This regex ignores nested copies of framework libraries so they're\n          // bundled with their issuer.\n          // https://github.com/vercel/next.js/pull/9012\n          test: /(?<!node_modules.*)[\\\\/]node_modules[\\\\/](react|react-dom|scheduler|prop-types|use-subscription)[\\\\/]/,\n          priority: 40,\n          // Don't let webpack eliminate this chunk (prevents this chunk from\n          // becoming a part of the commons chunk)\n          enforce: true\n        },\n        lib: {\n          test(module) {\n            return module.size() > 160000 && /node_modules[/\\\\]/.test(module.nameForCondition() || '');\n          },\n\n          name(module) {\n            const hash = _crypto.default.createHash('sha1');\n\n            if (isModuleCSS(module)) {\n              module.updateHash(hash);\n            } else {\n              if (!module.libIdent) {\n                throw new Error(`Encountered unknown module type: ${module.type}. Please open an issue.`);\n              }\n\n              hash.update(module.libIdent({\n                context: dir\n              }));\n            }\n\n            return hash.digest('hex').substring(0, 8);\n          },\n\n          priority: 30,\n          minChunks: 1,\n          reuseExistingChunk: true\n        },\n        commons: {\n          name: 'commons',\n          minChunks: totalPages,\n          priority: 20\n        },\n        ...(_webpack.isWebpack5 ? undefined : {\n          default: false,\n          vendors: false,\n          shared: {\n            name(module, chunks) {\n              return _crypto.default.createHash('sha1').update(chunks.reduce((acc, chunk) => {\n                return acc + chunk.name;\n              }, '')).digest('hex') + (isModuleCSS(module) ? '_CSS' : '');\n            },\n\n            priority: 10,\n            minChunks: 2,\n            reuseExistingChunk: true\n          }\n        })\n      },\n      maxInitialRequests: 25,\n      minSize: 20000\n    }\n  }; // Select appropriate SplitChunksPlugin config for this build\n\n  let splitChunksConfig;\n\n  if (dev) {\n    splitChunksConfig = _webpack.isWebpack5 ? false : splitChunksConfigs.dev;\n  } else {\n    splitChunksConfig = splitChunksConfigs.prodGranular;\n  }\n\n  const crossOrigin = config.crossOrigin;\n  const conformanceConfig = Object.assign({\n    ReactSyncScriptsConformanceCheck: {\n      enabled: true\n    },\n    MinificationConformanceCheck: {\n      enabled: true\n    },\n    DuplicatePolyfillsConformanceCheck: {\n      enabled: true,\n      BlockedAPIToBePolyfilled: Object.assign([], ['fetch'], ((ref2 = config.conformance) === null || ref2 === void 0 ? void 0 : (ref3 = ref2.DuplicatePolyfillsConformanceCheck) === null || ref3 === void 0 ? void 0 : ref3.BlockedAPIToBePolyfilled) || [])\n    },\n    GranularChunksConformanceCheck: {\n      enabled: true\n    }\n  }, config.conformance);\n  const esmExternals = !!((ref4 = config.experimental) === null || ref4 === void 0 ? void 0 : ref4.esmExternals);\n  const looseEsmExternals = ((ref5 = config.experimental) === null || ref5 === void 0 ? void 0 : ref5.esmExternals) === 'loose';\n\n  async function handleExternals(context, request, dependencyType, getResolve) {\n    // We need to externalize internal requests for files intended to\n    // not be bundled.\n    const isLocal = request.startsWith('.') || // Always check for unix-style path, as webpack sometimes\n    // normalizes as posix.\n    _path.default.posix.isAbsolute(request) || process.platform === 'win32' && _path.default.win32.isAbsolute(request); // Relative requires don't need custom resolution, because they\n    // are relative to requests we've already resolved here.\n    // Absolute requires (require('/foo')) are extremely uncommon, but\n    // also have no need for customization as they're already resolved.\n\n\n    if (!isLocal) {\n      if (/^(?:next$|react(?:$|\\/))/.test(request)) {\n        return `commonjs ${request}`;\n      }\n\n      const notExternalModules = /^(?:private-next-pages\\/|next\\/(?:dist\\/pages\\/|(?:app|document|link|image|constants|dynamic)$)|string-hash$)/;\n\n      if (notExternalModules.test(request)) {\n        return;\n      }\n    } // When in esm externals mode, and using import, we resolve with\n    // ESM resolving options.\n\n\n    const isEsmRequested = dependencyType === 'esm';\n    const preferEsm = esmExternals && isEsmRequested;\n    const resolve = getResolve(preferEsm ? WEBPACK_ESM_RESOLVE_OPTIONS : WEBPACK_RESOLVE_OPTIONS); // Resolve the import with the webpack provided context, this\n    // ensures we're resolving the correct version when multiple\n    // exist.\n\n    let res;\n    let isEsm = false;\n\n    try {\n      [res, isEsm] = await resolve(context, request);\n    } catch (err) {\n      res = null;\n    } // If resolving fails, and we can use an alternative way\n    // try the alternative resolving options.\n\n\n    if (!res && (isEsmRequested || looseEsmExternals)) {\n      const resolveAlternative = getResolve(preferEsm ? WEBPACK_RESOLVE_OPTIONS : WEBPACK_ESM_RESOLVE_OPTIONS);\n\n      try {\n        [res, isEsm] = await resolveAlternative(context, request);\n      } catch (err) {\n        res = null;\n      }\n    } // If the request cannot be resolved we need to have\n    // webpack \"bundle\" it so it surfaces the not found error.\n\n\n    if (!res) {\n      return;\n    } // ESM externals can only be imported (and not required).\n    // Make an exception in loose mode.\n\n\n    if (!isEsmRequested && isEsm && !looseEsmExternals) {\n      throw new Error(`ESM packages (${request}) need to be imported. Use 'import' to reference the package instead. https://nextjs.org/docs/messages/import-esm-externals`);\n    }\n\n    if (isLocal) {\n      // Makes sure dist/shared and dist/server are not bundled\n      // we need to process shared `router/router` and `dynamic`,\n      // so that the DefinePlugin can inject process.env values\n      const isNextExternal = /next[/\\\\]dist[/\\\\](shared|server)[/\\\\](?!lib[/\\\\](router[/\\\\]router|dynamic))/.test(res);\n\n      if (isNextExternal) {\n        // Generate Next.js external import\n        const externalRequest = _path.default.posix.join('next', 'dist', _path.default.relative( // Root of Next.js package:\n        _path.default.join(__dirname, '..'), res) // Windows path normalization\n        .replace(/\\\\/g, '/'));\n\n        return `commonjs ${externalRequest}`;\n      } else {\n        return;\n      }\n    } // Bundled Node.js code is relocated without its node_modules tree.\n    // This means we need to make sure its request resolves to the same\n    // package that'll be available at runtime. If it's not identical,\n    // we need to bundle the code (even if it _should_ be external).\n\n\n    let baseRes;\n    let baseIsEsm;\n\n    try {\n      const baseResolve = getResolve(isEsm ? NODE_ESM_RESOLVE_OPTIONS : NODE_RESOLVE_OPTIONS);\n      [baseRes, baseIsEsm] = await baseResolve(dir, request);\n    } catch (err) {\n      baseRes = null;\n      baseIsEsm = false;\n    } // Same as above: if the package, when required from the root,\n    // would be different from what the real resolution would use, we\n    // cannot externalize it.\n    // if request is pointing to a symlink it could point to the the same file,\n    // the resolver will resolve symlinks so this is handled\n\n\n    if (baseRes !== res || isEsm !== baseIsEsm) {\n      return;\n    }\n\n    const externalType = isEsm ? 'module' : 'commonjs';\n\n    if (res.match(/next[/\\\\]dist[/\\\\]shared[/\\\\](?!lib[/\\\\]router[/\\\\]router)/)) {\n      return `${externalType} ${request}`;\n    } // Default pages have to be transpiled\n\n\n    if (res.match(/[/\\\\]next[/\\\\]dist[/\\\\]/) || // This is the @babel/plugin-transform-runtime \"helpers: true\" option\n    res.match(/node_modules[/\\\\]@babel[/\\\\]runtime[/\\\\]/)) {\n      return;\n    } // Webpack itself has to be compiled because it doesn't always use module relative paths\n\n\n    if (res.match(/node_modules[/\\\\]webpack/) || res.match(/node_modules[/\\\\]css-loader/)) {\n      return;\n    } // Anything else that is standard JavaScript within `node_modules`\n    // can be externalized.\n\n\n    if (/node_modules[/\\\\].*\\.c?js$/.test(res)) {\n      return `${externalType} ${request}`;\n    } // Default behavior: bundle the code!\n\n  }\n\n  const emacsLockfilePattern = '**/.#*';\n  let webpackConfig = {\n    parallelism: Number(process.env.NEXT_WEBPACK_PARALLELISM) || undefined,\n    externals: !isServer ? // bundles in case a user imported types and it wasn't removed\n    // TODO: should we warn/error for this instead?\n    ['next'] : !isServerless ? [_webpack.isWebpack5 ? ({\n      context,\n      request,\n      dependencyType,\n      getResolve\n    }) => {\n      return handleExternals(context, request, dependencyType, options => {\n        const resolveFunction = getResolve(options);\n        return (resolveContext, requestToResolve) => {\n          return new Promise((resolve, reject) => {\n            resolveFunction(resolveContext, requestToResolve, (err, result, resolveData) => {\n              var ref10;\n              if (err) return reject(err);\n              if (!result) return resolve([null, false]);\n              const isEsm = /\\.js$/i.test(result) ? (resolveData === null || resolveData === void 0 ? void 0 : (ref10 = resolveData.descriptionFileData) === null || ref10 === void 0 ? void 0 : ref10.type) === 'module' : /\\.mjs$/i.test(result);\n              resolve([result, isEsm]);\n            });\n          });\n        };\n      });\n    } : (context, request, callback) => handleExternals(context, request, 'commonjs', () => (resolveContext, requestToResolve) => new Promise(resolve => resolve([require.resolve(requestToResolve, {\n      paths: [resolveContext]\n    }), false]))).then(result => callback(undefined, result), callback)] : [// When the 'serverless' target is used all node_modules will be compiled into the output bundles\n    // So that the 'serverless' bundles have 0 runtime dependencies\n    'next/dist/compiled/@ampproject/toolbox-optimizer', // Mark this as external if not enabled so it doesn't cause a\n    // webpack error from being missing\n    ...(config.experimental.optimizeCss ? [] : ['critters'])],\n    optimization: { // Webpack 5 uses a new property for the same functionality\n      ...(_webpack.isWebpack5 ? {\n        emitOnErrors: !dev\n      } : {\n        noEmitOnErrors: dev\n      }),\n      checkWasmTypes: false,\n      nodeEnv: false,\n      splitChunks: isServer ? _webpack.isWebpack5 && !dev ? {\n        filename: '[name].js',\n        // allow to split entrypoints\n        chunks: 'all',\n        // size of files is not so relevant for server build\n        // we want to prefer deduplication to load less code\n        minSize: 1000\n      } : false : splitChunksConfig,\n      runtimeChunk: isServer ? _webpack.isWebpack5 && !isLikeServerless ? {\n        name: 'webpack-runtime'\n      } : undefined : {\n        name: _constants1.CLIENT_STATIC_FILES_RUNTIME_WEBPACK\n      },\n      minimize: !(dev || isServer),\n      minimizer: [// Minify JavaScript\n      compiler => {\n        // @ts-ignore No typings yet\n        const {\n          TerserPlugin\n        } = require('./webpack/plugins/terser-webpack-plugin/src/index.js');\n\n        new TerserPlugin({\n          cacheDir: _path.default.join(distDir, 'cache', 'next-minifier'),\n          parallel: config.experimental.cpus,\n          swcMinify: config.experimental.swcMinify,\n          terserOptions\n        }).apply(compiler);\n      }, // Minify CSS\n      compiler => {\n        const {\n          CssMinimizerPlugin\n        } = require('./webpack/plugins/css-minimizer-plugin');\n\n        new CssMinimizerPlugin({\n          postcssOptions: {\n            map: {\n              // `inline: false` generates the source map in a separate file.\n              // Otherwise, the CSS file is needlessly large.\n              inline: false,\n              // `annotation: false` skips appending the `sourceMappingURL`\n              // to the end of the CSS file. Webpack already handles this.\n              annotation: false\n            }\n          }\n        }).apply(compiler);\n      }]\n    },\n    context: dir,\n    node: {\n      setImmediate: false\n    },\n    // Kept as function to be backwards compatible\n    // @ts-ignore TODO webpack 5 typings needed\n    entry: async () => {\n      return { ...(clientEntries ? clientEntries : {}),\n        ...entrypoints\n      };\n    },\n    watchOptions: {\n      aggregateTimeout: 5,\n      ignored: ['**/.git/**', '**/node_modules/**', '**/.next/**', // can be removed after https://github.com/paulmillr/chokidar/issues/955 is released\n      emacsLockfilePattern]\n    },\n    output: {\n      // we must set publicPath to an empty value to override the default of\n      // auto which doesn't work in IE11\n      publicPath: `${config.assetPrefix || ''}/_next/`,\n      path: isServer && _webpack.isWebpack5 && !dev ? _path.default.join(outputPath, 'chunks') : outputPath,\n      // On the server we don't use hashes\n      filename: isServer ? _webpack.isWebpack5 && !dev ? '../[name].js' : '[name].js' : `static/chunks/${isDevFallback ? 'fallback/' : ''}[name]${dev ? '' : _webpack.isWebpack5 ? '-[contenthash]' : '-[chunkhash]'}.js`,\n      library: isServer ? undefined : '_N_E',\n      libraryTarget: isServer ? 'commonjs2' : 'assign',\n      hotUpdateChunkFilename: _webpack.isWebpack5 ? 'static/webpack/[id].[fullhash].hot-update.js' : 'static/webpack/[id].[hash].hot-update.js',\n      hotUpdateMainFilename: _webpack.isWebpack5 ? 'static/webpack/[fullhash].[runtime].hot-update.json' : 'static/webpack/[hash].hot-update.json',\n      // This saves chunks with the name given via `import()`\n      chunkFilename: isServer ? '[name].js' : `static/chunks/${isDevFallback ? 'fallback/' : ''}${dev ? '[name]' : '[name].[contenthash]'}.js`,\n      strictModuleExceptionHandling: true,\n      crossOriginLoading: crossOrigin,\n      futureEmitAssets: !dev,\n      webassemblyModuleFilename: 'static/wasm/[modulehash].wasm'\n    },\n    performance: false,\n    resolve: resolveConfig,\n    resolveLoader: {\n      // The loaders Next.js provides\n      alias: ['emit-file-loader', 'error-loader', 'next-babel-loader', 'next-swc-loader', 'next-client-pages-loader', 'next-image-loader', 'next-serverless-loader', 'noop-loader', 'next-style-loader'].reduce((alias, loader) => {\n        // using multiple aliases to replace `resolveLoader.modules`\n        alias[loader] = _path.default.join(__dirname, 'webpack', 'loaders', loader);\n        return alias;\n      }, {}),\n      modules: ['node_modules', ...nodePathList],\n      plugins: _webpack.isWebpack5 ? [] : [require('pnp-webpack-plugin')]\n    },\n    module: {\n      rules: [...(_webpack.isWebpack5 ? [// TODO: FIXME: do NOT webpack 5 support with this\n      // x-ref: https://github.com/webpack/webpack/issues/11467\n      {\n        test: /\\.m?js/,\n        resolve: {\n          fullySpecified: false\n        }\n      }] : []), {\n        test: /\\.(tsx|ts|js|mjs|jsx)$/,\n        ...(config.experimental.externalDir ? {} : {\n          include: [dir, ...babelIncludeRegexes]\n        }),\n        exclude: excludePath => {\n          if (babelIncludeRegexes.some(r => r.test(excludePath))) {\n            return false;\n          }\n\n          return /node_modules/.test(excludePath);\n        },\n        use: hasReactRefresh ? [require.resolve('@next/react-refresh-utils/loader'), defaultLoaders.babel] : defaultLoaders.babel\n      }, ...(!config.images.disableStaticImages && _webpack.isWebpack5 ? [{\n        test: /\\.(png|jpg|jpeg|gif|webp|ico|bmp|svg)$/i,\n        loader: 'next-image-loader',\n        issuer: {\n          not: _css.regexLikeCss\n        },\n        dependency: {\n          not: ['url']\n        },\n        options: {\n          isServer,\n          isDev: dev,\n          assetPrefix: config.assetPrefix\n        }\n      }] : [])].filter(Boolean)\n    },\n    plugins: [hasReactRefresh && new _reactRefreshWebpackPlugin.default(_webpack.webpack), // Makes sure `Buffer` and `process` are polyfilled in client-side bundles (same behavior as webpack 4)\n    _webpack.isWebpack5 && !isServer && new _webpack.webpack.ProvidePlugin({\n      Buffer: [require.resolve('buffer'), 'Buffer'],\n      process: [require.resolve('process')]\n    }), // This plugin makes sure `output.filename` is used for entry chunks\n    !_webpack.isWebpack5 && new _chunkNamesPlugin.default(), new _webpack.webpack.DefinePlugin({ ...Object.keys(process.env).reduce((prev, key) => {\n        if (key.startsWith('NEXT_PUBLIC_')) {\n          prev[`process.env.${key}`] = JSON.stringify(process.env[key]);\n        }\n\n        return prev;\n      }, {}),\n      ...Object.keys(config.env).reduce((acc, key) => {\n        if (/^(?:NODE_.+)|^(?:__.+)$/i.test(key)) {\n          throw new Error(`The key \"${key}\" under \"env\" in next.config.js is not allowed. https://nextjs.org/docs/messages/env-key-not-allowed`);\n        }\n\n        return { ...acc,\n          [`process.env.${key}`]: JSON.stringify(config.env[key])\n        };\n      }, {}),\n      // TODO: enforce `NODE_ENV` on `process.env`, and add a test:\n      'process.env.NODE_ENV': JSON.stringify(dev ? 'development' : 'production'),\n      'process.env.__NEXT_CROSS_ORIGIN': JSON.stringify(crossOrigin),\n      'process.browser': JSON.stringify(!isServer),\n      'process.env.__NEXT_TEST_MODE': JSON.stringify(process.env.__NEXT_TEST_MODE),\n      // This is used in client/dev-error-overlay/hot-dev-client.js to replace the dist directory\n      ...(dev && !isServer ? {\n        'process.env.__NEXT_DIST_DIR': JSON.stringify(distDir)\n      } : {}),\n      'process.env.__NEXT_TRAILING_SLASH': JSON.stringify(config.trailingSlash),\n      'process.env.__NEXT_BUILD_INDICATOR': JSON.stringify(config.devIndicators.buildActivity),\n      'process.env.__NEXT_PLUGINS': JSON.stringify(config.experimental.plugins),\n      'process.env.__NEXT_STRICT_MODE': JSON.stringify(config.reactStrictMode),\n      'process.env.__NEXT_REACT_ROOT': JSON.stringify(hasReactRoot),\n      'process.env.__NEXT_CONCURRENT_FEATURES': JSON.stringify(config.experimental.concurrentFeatures && hasReactRoot),\n      'process.env.__NEXT_OPTIMIZE_FONTS': JSON.stringify(config.optimizeFonts && !dev),\n      'process.env.__NEXT_OPTIMIZE_IMAGES': JSON.stringify(config.experimental.optimizeImages),\n      'process.env.__NEXT_OPTIMIZE_CSS': JSON.stringify(config.experimental.optimizeCss && !dev),\n      'process.env.__NEXT_SCROLL_RESTORATION': JSON.stringify(config.experimental.scrollRestoration),\n      'process.env.__NEXT_IMAGE_OPTS': JSON.stringify({\n        deviceSizes: config.images.deviceSizes,\n        imageSizes: config.images.imageSizes,\n        path: config.images.path,\n        loader: config.images.loader,\n        ...(dev ? {\n          // pass domains in development to allow validating on the client\n          domains: config.images.domains\n        } : {})\n      }),\n      'process.env.__NEXT_ROUTER_BASEPATH': JSON.stringify(config.basePath),\n      'process.env.__NEXT_HAS_REWRITES': JSON.stringify(hasRewrites),\n      'process.env.__NEXT_I18N_SUPPORT': JSON.stringify(!!config.i18n),\n      'process.env.__NEXT_I18N_DOMAINS': JSON.stringify((ref6 = config.i18n) === null || ref6 === void 0 ? void 0 : ref6.domains),\n      'process.env.__NEXT_ANALYTICS_ID': JSON.stringify(config.analyticsId),\n      ...(isServer ? {\n        // Fix bad-actors in the npm ecosystem (e.g. `node-formidable`)\n        // This is typically found in unmaintained modules from the\n        // pre-webpack era (common in server-side code)\n        'global.GENTLY': JSON.stringify(false)\n      } : undefined),\n      // stub process.env with proxy to warn a missing value is\n      // being accessed in development mode\n      ...(config.experimental.pageEnv && dev ? {\n        'process.env': `\n            new Proxy(${isServer ? 'process.env' : '{}'}, {\n              get(target, prop) {\n                if (typeof target[prop] === 'undefined') {\n                  console.warn(\\`An environment variable (\\${prop}) that was not provided in the environment was accessed.\\nSee more info here: https://nextjs.org/docs/messages/missing-env-value\\`)\n                }\n                return target[prop]\n              }\n            })\n          `\n      } : {})\n    }), !isServer && new _reactLoadablePlugin.ReactLoadablePlugin({\n      filename: _constants1.REACT_LOADABLE_MANIFEST,\n      pagesDir\n    }), !isServer && new _nextDropClientPagePlugin.DropClientPage(), config.experimental.nftTracing && !isLikeServerless && isServer && !dev && _webpack.isWebpack5 && new _nextTraceEntrypointsPlugin.TraceEntryPointsPlugin({\n      appDir: dir\n    }), // Moment.js is an extremely popular library that bundles large locale files\n    // by default due to how Webpack interprets its code. This is a practical\n    // solution that requires the user to opt into importing specific locales.\n    // https://github.com/jmblog/how-to-optimize-momentjs-with-webpack\n    config.excludeDefaultMomentLocales && new _webpack.webpack.IgnorePlugin({\n      resourceRegExp: /^\\.\\/locale$/,\n      contextRegExp: /moment$/\n    }), ...(dev ? (() => {\n      // Even though require.cache is server only we have to clear assets from both compilations\n      // This is because the client compilation generates the build manifest that's used on the server side\n      const {\n        NextJsRequireCacheHotReloader\n      } = require('./webpack/plugins/nextjs-require-cache-hot-reloader');\n\n      const devPlugins = [new NextJsRequireCacheHotReloader()];\n\n      if (!isServer) {\n        devPlugins.push(new _webpack.webpack.HotModuleReplacementPlugin());\n      }\n\n      return devPlugins;\n    })() : []), // Webpack 5 no longer requires this plugin in production:\n    !_webpack.isWebpack5 && !dev && new _webpack.webpack.HashedModuleIdsPlugin(), !dev && new _webpack.webpack.IgnorePlugin({\n      resourceRegExp: /react-is/,\n      contextRegExp: /next[\\\\/]dist[\\\\/]/\n    }), isServerless && isServer && new _serverlessPlugin.ServerlessPlugin(), isServer && new _pagesManifestPlugin.default({\n      serverless: isLikeServerless,\n      dev\n    }), !_webpack.isWebpack5 && target === 'server' && isServer && new _nextjsSsrModuleCache.default({\n      outputPath\n    }), isServer && new _nextjsSsrImport.default(), !isServer && new _buildManifestPlugin.default({\n      buildId,\n      rewrites,\n      isDevFallback\n    }), !dev && !isServer && config.experimental.stats && new _buildStatsPlugin.default({\n      distDir\n    }), new _profilingPlugin.ProfilingPlugin({\n      runWebpackSpan\n    }), config.optimizeFonts && !dev && isServer && function () {\n      const {\n        FontStylesheetGatheringPlugin\n      } = require('./webpack/plugins/font-stylesheet-gathering-plugin');\n\n      return new FontStylesheetGatheringPlugin({\n        isLikeServerless\n      });\n    }(), config.experimental.conformance && !_webpack.isWebpack5 && !dev && new _webpackConformancePlugin.default({\n      tests: [!isServer && conformanceConfig.MinificationConformanceCheck.enabled && new _webpackConformancePlugin.MinificationConformanceCheck(), conformanceConfig.ReactSyncScriptsConformanceCheck.enabled && new _webpackConformancePlugin.ReactSyncScriptsConformanceCheck({\n        AllowedSources: conformanceConfig.ReactSyncScriptsConformanceCheck.allowedSources || []\n      }), !isServer && conformanceConfig.DuplicatePolyfillsConformanceCheck.enabled && new _webpackConformancePlugin.DuplicatePolyfillsConformanceCheck({\n        BlockedAPIToBePolyfilled: conformanceConfig.DuplicatePolyfillsConformanceCheck.BlockedAPIToBePolyfilled\n      }), !isServer && conformanceConfig.GranularChunksConformanceCheck.enabled && new _webpackConformancePlugin.GranularChunksConformanceCheck(splitChunksConfigs.prodGranular)].filter(Boolean)\n    }), new _wellknownErrorsPlugin.WellKnownErrorsPlugin(), !isServer && new _copyFilePlugin.CopyFilePlugin({\n      filePath: require.resolve('./polyfills/polyfill-nomodule'),\n      cacheKey: \"11.1.2\",\n      name: `static/chunks/polyfills${dev ? '' : '-[hash]'}.js`,\n      minimize: false,\n      info: {\n        [_constants1.CLIENT_STATIC_FILES_RUNTIME_POLYFILLS_SYMBOL]: 1,\n        // This file is already minified\n        minimized: true\n      }\n    })].filter(Boolean)\n  }; // Support tsconfig and jsconfig baseUrl\n\n  if (resolvedBaseUrl) {\n    var ref11, ref12;\n    (ref11 = webpackConfig.resolve) === null || ref11 === void 0 ? void 0 : (ref12 = ref11.modules) === null || ref12 === void 0 ? void 0 : ref12.push(resolvedBaseUrl);\n  }\n\n  if ((jsConfig === null || jsConfig === void 0 ? void 0 : (ref7 = jsConfig.compilerOptions) === null || ref7 === void 0 ? void 0 : ref7.paths) && resolvedBaseUrl) {\n    var ref13, ref14;\n    (ref13 = webpackConfig.resolve) === null || ref13 === void 0 ? void 0 : (ref14 = ref13.plugins) === null || ref14 === void 0 ? void 0 : ref14.unshift(new _jsconfigPathsPlugin.JsConfigPathsPlugin(jsConfig.compilerOptions.paths, resolvedBaseUrl));\n  }\n\n  if (_webpack.isWebpack5) {\n    var ref15; // futureEmitAssets is on by default in webpack 5\n\n    (ref15 = webpackConfig.output) === null || ref15 === void 0 ? void 0 : delete ref15.futureEmitAssets;\n\n    if (isServer && dev) {\n      // Enable building of client compilation before server compilation in development\n      // @ts-ignore dependencies exists\n      webpackConfig.dependencies = ['client'];\n    } // webpack 5 no longer polyfills Node.js modules:\n\n\n    if (webpackConfig.node) delete webpackConfig.node.setImmediate; // Due to bundling of webpack the default values can't be correctly detected\n    // This restores the webpack defaults\n    // @ts-ignore webpack 5\n\n    webpackConfig.snapshot = {};\n\n    if (process.versions.pnp === '3') {\n      const match = /^(.+?)[\\\\/]cache[\\\\/]jest-worker-npm-[^\\\\/]+\\.zip[\\\\/]node_modules[\\\\/]/.exec(require.resolve('jest-worker'));\n\n      if (match) {\n        // @ts-ignore webpack 5\n        webpackConfig.snapshot.managedPaths = [_path.default.resolve(match[1], 'unplugged')];\n      }\n    } else {\n      const match = /^(.+?[\\\\/]node_modules)[\\\\/]/.exec(require.resolve('jest-worker'));\n\n      if (match) {\n        // @ts-ignore webpack 5\n        webpackConfig.snapshot.managedPaths = [match[1]];\n      }\n    }\n\n    if (process.versions.pnp === '1') {\n      const match = /^(.+?[\\\\/]v4)[\\\\/]npm-jest-worker-[^\\\\/]+-[\\da-f]{40}[\\\\/]node_modules[\\\\/]/.exec(require.resolve('jest-worker'));\n\n      if (match) {\n        // @ts-ignore webpack 5\n        webpackConfig.snapshot.immutablePaths = [match[1]];\n      }\n    } else if (process.versions.pnp === '3') {\n      const match = /^(.+?)[\\\\/]jest-worker-npm-[^\\\\/]+\\.zip[\\\\/]node_modules[\\\\/]/.exec(require.resolve('jest-worker'));\n\n      if (match) {\n        // @ts-ignore webpack 5\n        webpackConfig.snapshot.immutablePaths = [match[1]];\n      }\n    }\n\n    if (dev) {\n      if (!webpackConfig.optimization) {\n        webpackConfig.optimization = {};\n      }\n\n      webpackConfig.optimization.providedExports = false;\n      webpackConfig.optimization.usedExports = false;\n    }\n\n    const configVars = JSON.stringify({\n      crossOrigin: config.crossOrigin,\n      pageExtensions: config.pageExtensions,\n      trailingSlash: config.trailingSlash,\n      buildActivity: config.devIndicators.buildActivity,\n      productionBrowserSourceMaps: !!config.productionBrowserSourceMaps,\n      plugins: config.experimental.plugins,\n      reactStrictMode: config.reactStrictMode,\n      reactMode: config.experimental.reactMode,\n      optimizeFonts: config.optimizeFonts,\n      optimizeImages: config.experimental.optimizeImages,\n      optimizeCss: config.experimental.optimizeCss,\n      scrollRestoration: config.experimental.scrollRestoration,\n      basePath: config.basePath,\n      pageEnv: config.experimental.pageEnv,\n      excludeDefaultMomentLocales: config.excludeDefaultMomentLocales,\n      assetPrefix: config.assetPrefix,\n      disableOptimizedLoading: config.experimental.disableOptimizedLoading,\n      target,\n      reactProductionProfiling,\n      webpack: !!config.webpack,\n      hasRewrites,\n      reactRoot: config.experimental.reactRoot,\n      concurrentFeatures: config.experimental.concurrentFeatures\n    });\n    const cache = {\n      type: 'filesystem',\n      // Includes:\n      //  - Next.js version\n      //  - next.config.js keys that affect compilation\n      version: `${\"11.1.2\"}|${configVars}`,\n      cacheDirectory: _path.default.join(distDir, 'cache', 'webpack')\n    }; // Adds `next.config.js` as a buildDependency when custom webpack config is provided\n\n    if (config.webpack && config.configFile) {\n      cache.buildDependencies = {\n        config: [config.configFile]\n      };\n    }\n\n    webpackConfig.cache = cache;\n\n    if (process.env.NEXT_WEBPACK_LOGGING) {\n      const logInfra = process.env.NEXT_WEBPACK_LOGGING.includes('infrastructure');\n      const logProfileClient = process.env.NEXT_WEBPACK_LOGGING.includes('profile-client');\n      const logProfileServer = process.env.NEXT_WEBPACK_LOGGING.includes('profile-server');\n      const logDefault = !logInfra && !logProfileClient && !logProfileServer;\n\n      if (logDefault || logInfra) {\n        // @ts-ignore TODO: remove ignore when webpack 5 is stable\n        webpackConfig.infrastructureLogging = {\n          level: 'verbose',\n          debug: /FileSystemInfo/\n        };\n      }\n\n      if (logDefault || logProfileClient && !isServer || logProfileServer && isServer) {\n        webpackConfig.plugins.push(compiler => {\n          compiler.hooks.done.tap('next-webpack-logging', stats => {\n            console.log(stats.toString({\n              colors: true,\n              // @ts-ignore TODO: remove ignore when webpack 5 is stable\n              logging: logDefault ? 'log' : 'verbose'\n            }));\n          });\n        });\n      }\n\n      if (logProfileClient && !isServer || logProfileServer && isServer) {\n        webpackConfig.plugins.push(new _webpack.webpack.ProgressPlugin({\n          // @ts-ignore TODO: remove ignore when webpack 5 is stable\n          profile: true\n        }));\n        webpackConfig.profile = true;\n      }\n    }\n  }\n\n  webpackConfig = await (0, _config).build(webpackConfig, {\n    rootDirectory: dir,\n    customAppFile: new RegExp(_path.default.join(pagesDir, `_app`).replace(/\\\\/g, '(/|\\\\\\\\)')),\n    isDevelopment: dev,\n    isServer,\n    assetPrefix: config.assetPrefix || '',\n    sassOptions: config.sassOptions,\n    productionBrowserSourceMaps: config.productionBrowserSourceMaps,\n    future: config.future,\n    isCraCompat: config.experimental.craCompat\n  });\n  let originalDevtool = webpackConfig.devtool;\n\n  if (typeof config.webpack === 'function') {\n    webpackConfig = config.webpack(webpackConfig, {\n      dir,\n      dev,\n      isServer,\n      buildId,\n      config,\n      defaultLoaders,\n      totalPages,\n      webpack: _webpack.webpack\n    });\n\n    if (!webpackConfig) {\n      throw new Error('Webpack config is undefined. You may have forgot to return properly from within the \"webpack\" method of your next.config.js.\\n' + 'See more info here https://nextjs.org/docs/messages/undefined-webpack-config');\n    }\n\n    if (dev && originalDevtool !== webpackConfig.devtool) {\n      webpackConfig.devtool = originalDevtool;\n      devtoolRevertWarning(originalDevtool);\n    }\n\n    if (typeof webpackConfig.then === 'function') {\n      console.warn('> Promise returned in next config. https://nextjs.org/docs/messages/promise-in-next-config');\n    }\n  }\n\n  if (!config.images.disableStaticImages && _webpack.isWebpack5) {\n    var ref16;\n    const rules = ((ref16 = webpackConfig.module) === null || ref16 === void 0 ? void 0 : ref16.rules) || [];\n    const hasCustomSvg = rules.some(rule => rule.loader !== 'next-image-loader' && 'test' in rule && rule.test instanceof RegExp && rule.test.test('.svg'));\n    const nextImageRule = rules.find(rule => rule.loader === 'next-image-loader');\n\n    if (hasCustomSvg && nextImageRule) {\n      // Exclude svg if the user already defined it in custom\n      // webpack config such as `@svgr/webpack` plugin or\n      // the `babel-plugin-inline-react-svg` plugin.\n      nextImageRule.test = /\\.(png|jpg|jpeg|gif|webp|ico|bmp)$/i;\n    }\n  }\n\n  if (config.experimental.craCompat && ((ref8 = webpackConfig.module) === null || ref8 === void 0 ? void 0 : ref8.rules) && webpackConfig.plugins) {\n    // CRA prevents loading all locales by default\n    // https://github.com/facebook/create-react-app/blob/fddce8a9e21bf68f37054586deb0c8636a45f50b/packages/react-scripts/config/webpack.config.js#L721\n    webpackConfig.plugins.push(new _webpack.webpack.IgnorePlugin(/^\\.\\/locale$/, /moment$/)); // CRA allows importing non-webpack handled files with file-loader\n    // these need to be the last rule to prevent catching other items\n    // https://github.com/facebook/create-react-app/blob/fddce8a9e21bf68f37054586deb0c8636a45f50b/packages/react-scripts/config/webpack.config.js#L594\n\n    const fileLoaderExclude = [/\\.(js|mjs|jsx|ts|tsx|json)$/];\n    const fileLoader = _webpack.isWebpack5 ? {\n      exclude: fileLoaderExclude,\n      issuer: fileLoaderExclude,\n      type: 'asset/resource',\n      generator: {\n        publicPath: '/_next/',\n        filename: 'static/media/[name].[hash:8].[ext]'\n      }\n    } : {\n      loader: require.resolve('next/dist/compiled/file-loader'),\n      // Exclude `js` files to keep \"css\" loader working as it injects\n      // its runtime that would otherwise be processed through \"file\" loader.\n      // Also exclude `html` and `json` extensions so they get processed\n      // by webpacks internal loaders.\n      exclude: fileLoaderExclude,\n      issuer: fileLoaderExclude,\n      options: {\n        publicPath: '/_next/static/media',\n        outputPath: 'static/media',\n        name: '[name].[hash:8].[ext]'\n      }\n    };\n    const topRules = [];\n    const innerRules = [];\n\n    for (const rule of webpackConfig.module.rules) {\n      if (rule.resolve) {\n        topRules.push(rule);\n      } else {\n        if (rule.oneOf && !(rule.test || rule.exclude || rule.resource || rule.issuer)) {\n          rule.oneOf.forEach(r => innerRules.push(r));\n        } else {\n          innerRules.push(rule);\n        }\n      }\n    }\n\n    webpackConfig.module.rules = [...topRules, {\n      oneOf: [...innerRules, fileLoader]\n    }];\n  } // Backwards compat with webpack-dev-middleware options object\n\n\n  if (typeof config.webpackDevMiddleware === 'function') {\n    const options = config.webpackDevMiddleware({\n      watchOptions: webpackConfig.watchOptions\n    });\n\n    if (options.watchOptions) {\n      webpackConfig.watchOptions = options.watchOptions;\n    }\n  }\n\n  function canMatchCss(rule) {\n    if (!rule) {\n      return false;\n    }\n\n    const fileNames = ['/tmp/test.css', '/tmp/test.scss', '/tmp/test.sass', '/tmp/test.less', '/tmp/test.styl'];\n\n    if (rule instanceof RegExp && fileNames.some(input => rule.test(input))) {\n      return true;\n    }\n\n    if (typeof rule === 'function') {\n      if (fileNames.some(input => {\n        try {\n          if (rule(input)) {\n            return true;\n          }\n        } catch (_) {}\n\n        return false;\n      })) {\n        return true;\n      }\n    }\n\n    if (Array.isArray(rule) && rule.some(canMatchCss)) {\n      return true;\n    }\n\n    return false;\n  }\n\n  var ref17;\n  const hasUserCssConfig = (ref17 = (ref9 = webpackConfig.module) === null || ref9 === void 0 ? void 0 : ref9.rules.some(rule => canMatchCss(rule.test) || canMatchCss(rule.include))) !== null && ref17 !== void 0 ? ref17 : false;\n\n  if (hasUserCssConfig) {\n    var ref18, ref19, ref20, ref21; // only show warning for one build\n\n    if (isServer) {\n      console.warn(_chalk.default.yellow.bold('Warning: ') + _chalk.default.bold('Built-in CSS support is being disabled due to custom CSS configuration being detected.\\n') + 'See here for more info: https://nextjs.org/docs/messages/built-in-css-disabled\\n');\n    }\n\n    if ((ref18 = webpackConfig.module) === null || ref18 === void 0 ? void 0 : ref18.rules.length) {\n      // Remove default CSS Loader\n      webpackConfig.module.rules = webpackConfig.module.rules.filter(r => {\n        var ref22, ref23;\n        return !(typeof ((ref22 = r.oneOf) === null || ref22 === void 0 ? void 0 : (ref23 = ref22[0]) === null || ref23 === void 0 ? void 0 : ref23.options) === 'object' && r.oneOf[0].options.__next_css_remove === true);\n      });\n    }\n\n    if ((ref19 = webpackConfig.plugins) === null || ref19 === void 0 ? void 0 : ref19.length) {\n      // Disable CSS Extraction Plugin\n      webpackConfig.plugins = webpackConfig.plugins.filter(p => p.__next_css_remove !== true);\n    }\n\n    if ((ref20 = webpackConfig.optimization) === null || ref20 === void 0 ? void 0 : (ref21 = ref20.minimizer) === null || ref21 === void 0 ? void 0 : ref21.length) {\n      // Disable CSS Minifier\n      webpackConfig.optimization.minimizer = webpackConfig.optimization.minimizer.filter(e => e.__next_css_remove !== true);\n    }\n  } else if (!config.future.strictPostcssConfiguration) {\n    await (0, _overrideCssConfiguration).__overrideCssConfiguration(dir, !dev, webpackConfig);\n  } // Inject missing React Refresh loaders so that development mode is fast:\n\n\n  if (hasReactRefresh) {\n    attachReactRefresh(webpackConfig, defaultLoaders.babel);\n  } // check if using @zeit/next-typescript and show warning\n\n\n  if (isServer && webpackConfig.module && Array.isArray(webpackConfig.module.rules)) {\n    let foundTsRule = false;\n    webpackConfig.module.rules = webpackConfig.module.rules.filter(rule => {\n      if (!(rule.test instanceof RegExp)) return true;\n\n      if ('noop.ts'.match(rule.test) && !'noop.js'.match(rule.test)) {\n        // remove if it matches @zeit/next-typescript\n        foundTsRule = rule.use === defaultLoaders.babel;\n        return !foundTsRule;\n      }\n\n      return true;\n    });\n\n    if (foundTsRule) {\n      console.warn('\\n@zeit/next-typescript is no longer needed since Next.js has built-in support for TypeScript now. Please remove it from your next.config.js and your .babelrc\\n');\n    }\n  } // Patch `@zeit/next-sass`, `@zeit/next-less`, `@zeit/next-stylus` for compatibility\n\n\n  if (webpackConfig.module && Array.isArray(webpackConfig.module.rules)) {\n    [].forEach.call(webpackConfig.module.rules, function (rule) {\n      if (!(rule.test instanceof RegExp && Array.isArray(rule.use))) {\n        return;\n      }\n\n      const isSass = rule.test.source === '\\\\.scss$' || rule.test.source === '\\\\.sass$';\n      const isLess = rule.test.source === '\\\\.less$';\n      const isCss = rule.test.source === '\\\\.css$';\n      const isStylus = rule.test.source === '\\\\.styl$'; // Check if the rule we're iterating over applies to Sass, Less, or CSS\n\n      if (!(isSass || isLess || isCss || isStylus)) {\n        return;\n      }\n\n      [].forEach.call(rule.use, function (use) {\n        if (!(use && typeof use === 'object' && (use.loader === 'css-loader' || use.loader === 'css-loader/locals') && use.options && typeof use.options === 'object' && (Object.prototype.hasOwnProperty.call(use.options, 'minimize') || Object.prototype.hasOwnProperty.call(use.options, 'exportOnlyLocals')))) {\n          return;\n        } // Try to monkey patch within a try-catch. We shouldn't fail the build\n        // if we cannot pull this off.\n        // The user may not even be using the `next-sass` or `next-less` or\n        // `next-stylus` plugins.\n        // If it does work, great!\n\n\n        try {\n          // Resolve the version of `@zeit/next-css` as depended on by the Sass,\n          // Less or Stylus plugin.\n          const correctNextCss = require.resolve('@zeit/next-css', {\n            paths: [isCss ? dir : require.resolve(isSass ? '@zeit/next-sass' : isLess ? '@zeit/next-less' : isStylus ? '@zeit/next-stylus' : 'next')]\n          }); // If we found `@zeit/next-css` ...\n\n\n          if (correctNextCss) {\n            // ... resolve the version of `css-loader` shipped with that\n            // package instead of whichever was hoisted highest in your\n            // `node_modules` tree.\n            const correctCssLoader = require.resolve(use.loader, {\n              paths: [correctNextCss]\n            });\n\n            if (correctCssLoader) {\n              // We saved the user from a failed build!\n              use.loader = correctCssLoader;\n            }\n          }\n        } catch (_) {// The error is not required to be handled.\n        }\n      });\n    });\n  } // Backwards compat for `main.js` entry key\n  // and setup of dependencies between entries\n  // we can't do that in the initial entry for\n  // backward-compat reasons\n\n\n  const originalEntry = webpackConfig.entry;\n\n  if (typeof originalEntry !== 'undefined') {\n    const updatedEntry = async () => {\n      const entry = typeof originalEntry === 'function' ? await originalEntry() : originalEntry; // Server compilation doesn't have main.js\n\n      if (clientEntries && Array.isArray(entry['main.js']) && entry['main.js'].length > 0) {\n        const originalFile = clientEntries[_constants1.CLIENT_STATIC_FILES_RUNTIME_MAIN];\n        entry[_constants1.CLIENT_STATIC_FILES_RUNTIME_MAIN] = [...entry['main.js'], originalFile];\n      }\n\n      delete entry['main.js'];\n\n      if (_webpack.isWebpack5 && !isServer) {\n        for (const name of Object.keys(entry)) {\n          if (name === 'polyfills' || name === 'main' || name === 'amp' || name === 'react-refresh') continue;\n          const dependOn = name.startsWith('pages/') && name !== 'pages/_app' ? 'pages/_app' : 'main';\n          const old = entry[name];\n\n          if (typeof old === 'object' && !Array.isArray(old)) {\n            entry[name] = {\n              dependOn,\n              ...old\n            };\n          } else {\n            entry[name] = {\n              import: old,\n              dependOn\n            };\n          }\n        }\n      }\n\n      return entry;\n    }; // @ts-ignore webpack 5 typings needed\n\n\n    webpackConfig.entry = updatedEntry;\n  }\n\n  if (!dev) {\n    // entry is always a function\n    webpackConfig.entry = await webpackConfig.entry();\n  }\n\n  return webpackConfig;\n}","map":{"version":3,"sources":["../../build/webpack-config.ts"],"names":[],"mappings":"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","sourcesContent":["import ReactRefreshWebpackPlugin from '@next/react-refresh-utils/ReactRefreshWebpackPlugin'\nimport chalk from 'chalk'\nimport crypto from 'crypto'\nimport { readFileSync } from 'fs'\nimport { codeFrameColumns } from 'next/dist/compiled/babel/code-frame'\nimport semver from 'next/dist/compiled/semver'\nimport { isWebpack5, webpack } from 'next/dist/compiled/webpack/webpack'\nimport path, { join as pathJoin, relative as relativePath } from 'path'\nimport {\n  DOT_NEXT_ALIAS,\n  NEXT_PROJECT_ROOT,\n  NEXT_PROJECT_ROOT_DIST_CLIENT,\n  PAGES_DIR_ALIAS,\n} from '../lib/constants'\nimport { fileExists } from '../lib/file-exists'\nimport { getPackageVersion } from '../lib/get-package-version'\nimport { CustomRoutes } from '../lib/load-custom-routes.js'\nimport { getTypeScriptConfiguration } from '../lib/typescript/getTypeScriptConfiguration'\nimport {\n  CLIENT_STATIC_FILES_RUNTIME_AMP,\n  CLIENT_STATIC_FILES_RUNTIME_MAIN,\n  CLIENT_STATIC_FILES_RUNTIME_POLYFILLS_SYMBOL,\n  CLIENT_STATIC_FILES_RUNTIME_REACT_REFRESH,\n  CLIENT_STATIC_FILES_RUNTIME_WEBPACK,\n  REACT_LOADABLE_MANIFEST,\n  SERVERLESS_DIRECTORY,\n  SERVER_DIRECTORY,\n} from '../shared/lib/constants'\nimport { execOnce } from '../shared/lib/utils'\nimport { NextConfigComplete } from '../server/config-shared'\nimport { WebpackEntrypoints } from './entries'\nimport * as Log from './output/log'\nimport { build as buildConfiguration } from './webpack/config'\nimport { __overrideCssConfiguration } from './webpack/config/blocks/css/overrideCssConfiguration'\nimport BuildManifestPlugin from './webpack/plugins/build-manifest-plugin'\nimport BuildStatsPlugin from './webpack/plugins/build-stats-plugin'\nimport ChunkNamesPlugin from './webpack/plugins/chunk-names-plugin'\nimport { JsConfigPathsPlugin } from './webpack/plugins/jsconfig-paths-plugin'\nimport { DropClientPage } from './webpack/plugins/next-drop-client-page-plugin'\nimport { TraceEntryPointsPlugin } from './webpack/plugins/next-trace-entrypoints-plugin'\nimport NextJsSsrImportPlugin from './webpack/plugins/nextjs-ssr-import'\nimport NextJsSSRModuleCachePlugin from './webpack/plugins/nextjs-ssr-module-cache'\nimport PagesManifestPlugin from './webpack/plugins/pages-manifest-plugin'\nimport { ProfilingPlugin } from './webpack/plugins/profiling-plugin'\nimport { ReactLoadablePlugin } from './webpack/plugins/react-loadable-plugin'\nimport { ServerlessPlugin } from './webpack/plugins/serverless-plugin'\nimport WebpackConformancePlugin, {\n  DuplicatePolyfillsConformanceCheck,\n  GranularChunksConformanceCheck,\n  MinificationConformanceCheck,\n  ReactSyncScriptsConformanceCheck,\n} from './webpack/plugins/webpack-conformance-plugin'\nimport { WellKnownErrorsPlugin } from './webpack/plugins/wellknown-errors-plugin'\nimport { regexLikeCss } from './webpack/config/blocks/css'\nimport { CopyFilePlugin } from './webpack/plugins/copy-file-plugin'\nimport type { Span } from '../telemetry/trace'\n\ntype ExcludesFalse = <T>(x: T | false) => x is T\n\nconst devtoolRevertWarning = execOnce(\n  (devtool: webpack.Configuration['devtool']) => {\n    console.warn(\n      chalk.yellow.bold('Warning: ') +\n        chalk.bold(`Reverting webpack devtool to '${devtool}'.\\n`) +\n        'Changing the webpack devtool in development mode will cause severe performance regressions.\\n' +\n        'Read more: https://nextjs.org/docs/messages/improper-devtool'\n    )\n  }\n)\n\nfunction parseJsonFile(filePath: string) {\n  const JSON5 = require('next/dist/compiled/json5')\n  const contents = readFileSync(filePath, 'utf8')\n\n  // Special case an empty file\n  if (contents.trim() === '') {\n    return {}\n  }\n\n  try {\n    return JSON5.parse(contents)\n  } catch (err) {\n    const codeFrame = codeFrameColumns(\n      String(contents),\n      { start: { line: err.lineNumber, column: err.columnNumber } },\n      { message: err.message, highlightCode: true }\n    )\n    throw new Error(`Failed to parse \"${filePath}\":\\n${codeFrame}`)\n  }\n}\n\nfunction getOptimizedAliases(isServer: boolean): { [pkg: string]: string } {\n  if (isServer) {\n    return {}\n  }\n\n  const stubWindowFetch = path.join(__dirname, 'polyfills', 'fetch', 'index.js')\n  const stubObjectAssign = path.join(__dirname, 'polyfills', 'object-assign.js')\n\n  const shimAssign = path.join(__dirname, 'polyfills', 'object.assign')\n  return Object.assign(\n    {},\n    {\n      unfetch$: stubWindowFetch,\n      'isomorphic-unfetch$': stubWindowFetch,\n      'whatwg-fetch$': path.join(\n        __dirname,\n        'polyfills',\n        'fetch',\n        'whatwg-fetch.js'\n      ),\n    },\n    {\n      'object-assign$': stubObjectAssign,\n\n      // Stub Package: object.assign\n      'object.assign/auto': path.join(shimAssign, 'auto.js'),\n      'object.assign/implementation': path.join(\n        shimAssign,\n        'implementation.js'\n      ),\n      'object.assign$': path.join(shimAssign, 'index.js'),\n      'object.assign/polyfill': path.join(shimAssign, 'polyfill.js'),\n      'object.assign/shim': path.join(shimAssign, 'shim.js'),\n\n      // Replace: full URL polyfill with platform-based polyfill\n      url: require.resolve('native-url'),\n    }\n  )\n}\n\ntype ClientEntries = {\n  [key: string]: string | string[]\n}\n\nexport function attachReactRefresh(\n  webpackConfig: webpack.Configuration,\n  targetLoader: webpack.RuleSetUseItem\n) {\n  let injections = 0\n  const reactRefreshLoaderName = '@next/react-refresh-utils/loader'\n  const reactRefreshLoader = require.resolve(reactRefreshLoaderName)\n  webpackConfig.module?.rules.forEach((rule) => {\n    const curr = rule.use\n    // When the user has configured `defaultLoaders.babel` for a input file:\n    if (curr === targetLoader) {\n      ++injections\n      rule.use = [reactRefreshLoader, curr as webpack.RuleSetUseItem]\n    } else if (\n      Array.isArray(curr) &&\n      curr.some((r) => r === targetLoader) &&\n      // Check if loader already exists:\n      !curr.some(\n        (r) => r === reactRefreshLoader || r === reactRefreshLoaderName\n      )\n    ) {\n      ++injections\n      const idx = curr.findIndex((r) => r === targetLoader)\n      // Clone to not mutate user input\n      rule.use = [...curr]\n\n      // inject / input: [other, babel] output: [other, refresh, babel]:\n      rule.use.splice(idx, 0, reactRefreshLoader)\n    }\n  })\n\n  if (injections) {\n    Log.info(\n      `automatically enabled Fast Refresh for ${injections} custom loader${\n        injections > 1 ? 's' : ''\n      }`\n    )\n  }\n}\n\nconst WEBPACK_RESOLVE_OPTIONS = {\n  // This always uses commonjs resolving, assuming API is identical\n  // between ESM and CJS in a package\n  // Otherwise combined ESM+CJS packages will never be external\n  // as resolving mismatch would lead to opt-out from being external.\n  dependencyType: 'commonjs',\n  symlinks: true,\n}\n\nconst WEBPACK_ESM_RESOLVE_OPTIONS = {\n  dependencyType: 'esm',\n  symlinks: true,\n}\n\nconst NODE_RESOLVE_OPTIONS = {\n  dependencyType: 'commonjs',\n  modules: ['node_modules'],\n  alias: false,\n  fallback: false,\n  exportsFields: ['exports'],\n  importsFields: ['imports'],\n  conditionNames: ['node', 'require', 'module'],\n  descriptionFiles: ['package.json'],\n  extensions: ['.js', '.json', '.node'],\n  enforceExtensions: false,\n  symlinks: true,\n  mainFields: ['main'],\n  mainFiles: ['index'],\n  roots: [],\n  fullySpecified: false,\n  preferRelative: false,\n  preferAbsolute: false,\n  restrictions: [],\n}\n\nconst NODE_ESM_RESOLVE_OPTIONS = {\n  ...NODE_RESOLVE_OPTIONS,\n  dependencyType: 'esm',\n  conditionNames: ['node', 'import', 'module'],\n  fullySpecified: true,\n}\n\nexport default async function getBaseWebpackConfig(\n  dir: string,\n  {\n    buildId,\n    config,\n    dev = false,\n    isServer = false,\n    pagesDir,\n    target = 'server',\n    reactProductionProfiling = false,\n    entrypoints,\n    rewrites,\n    isDevFallback = false,\n    runWebpackSpan,\n  }: {\n    buildId: string\n    config: NextConfigComplete\n    dev?: boolean\n    isServer?: boolean\n    pagesDir: string\n    target?: string\n    reactProductionProfiling?: boolean\n    entrypoints: WebpackEntrypoints\n    rewrites: CustomRoutes['rewrites']\n    isDevFallback?: boolean\n    runWebpackSpan: Span\n  }\n): Promise<webpack.Configuration> {\n  const hasRewrites =\n    rewrites.beforeFiles.length > 0 ||\n    rewrites.afterFiles.length > 0 ||\n    rewrites.fallback.length > 0\n  const hasReactRefresh: boolean = dev && !isServer\n  const reactDomVersion = await getPackageVersion({\n    cwd: dir,\n    name: 'react-dom',\n  })\n  const hasReact18: boolean =\n    Boolean(reactDomVersion) &&\n    (semver.gte(reactDomVersion!, '18.0.0') ||\n      semver.coerce(reactDomVersion)?.version === '18.0.0')\n  const hasReactPrerelease =\n    Boolean(reactDomVersion) && semver.prerelease(reactDomVersion!) != null\n  const hasReactRoot: boolean = config.experimental.reactRoot || hasReact18\n\n  // Only inform during one of the builds\n  if (!isServer) {\n    if (hasReactRoot) {\n      Log.info('Using the createRoot API for React')\n    }\n    if (hasReactPrerelease) {\n      Log.warn(\n        `You are using an unsupported prerelease of 'react-dom' which may cause ` +\n          `unexpected or broken application behavior. Continue at your own risk.`\n      )\n    }\n  }\n\n  const babelConfigFile = await [\n    '.babelrc',\n    '.babelrc.json',\n    '.babelrc.js',\n    '.babelrc.mjs',\n    '.babelrc.cjs',\n    'babel.config.js',\n    'babel.config.json',\n    'babel.config.mjs',\n    'babel.config.cjs',\n  ].reduce(async (memo: Promise<string | undefined>, filename) => {\n    const configFilePath = path.join(dir, filename)\n    return (\n      (await memo) ||\n      ((await fileExists(configFilePath)) ? configFilePath : undefined)\n    )\n  }, Promise.resolve(undefined))\n\n  const distDir = path.join(dir, config.distDir)\n\n  // Webpack 5 can use the faster babel loader, webpack 5 has built-in caching for loaders\n  // For webpack 4 the old loader is used as it has external caching\n  const babelLoader = isWebpack5\n    ? require.resolve('./babel/loader/index')\n    : 'next-babel-loader'\n\n  const useSWCLoader = config.experimental.swcLoader && isWebpack5\n  if (useSWCLoader && babelConfigFile) {\n    Log.warn(\n      `experimental.swcLoader enabled. The custom Babel configuration will not be used.`\n    )\n  }\n  const defaultLoaders = {\n    babel: useSWCLoader\n      ? {\n          loader: 'next-swc-loader',\n          options: {\n            isServer,\n          },\n        }\n      : {\n          loader: babelLoader,\n          options: {\n            configFile: babelConfigFile,\n            isServer,\n            distDir,\n            pagesDir,\n            cwd: dir,\n            // Webpack 5 has a built-in loader cache\n            cache: !isWebpack5,\n            development: dev,\n            hasReactRefresh,\n            hasJsxRuntime: true,\n          },\n        },\n    // Backwards compat\n    hotSelfAccept: {\n      loader: 'noop-loader',\n    },\n  }\n\n  const babelIncludeRegexes: RegExp[] = [\n    /next[\\\\/]dist[\\\\/]shared[\\\\/]lib/,\n    /next[\\\\/]dist[\\\\/]client/,\n    /next[\\\\/]dist[\\\\/]pages/,\n    /[\\\\/](strip-ansi|ansi-regex)[\\\\/]/,\n  ]\n\n  // Support for NODE_PATH\n  const nodePathList = (process.env.NODE_PATH || '')\n    .split(process.platform === 'win32' ? ';' : ':')\n    .filter((p) => !!p)\n\n  const isServerless = target === 'serverless'\n  const isServerlessTrace = target === 'experimental-serverless-trace'\n  // Intentionally not using isTargetLikeServerless helper\n  const isLikeServerless = isServerless || isServerlessTrace\n\n  const outputDir = isLikeServerless ? SERVERLESS_DIRECTORY : SERVER_DIRECTORY\n  const outputPath = path.join(distDir, isServer ? outputDir : '')\n  const totalPages = Object.keys(entrypoints).length\n  const clientEntries = !isServer\n    ? ({\n        // Backwards compatibility\n        'main.js': [],\n        ...(dev\n          ? {\n              [CLIENT_STATIC_FILES_RUNTIME_REACT_REFRESH]: require.resolve(\n                `@next/react-refresh-utils/runtime`\n              ),\n              [CLIENT_STATIC_FILES_RUNTIME_AMP]:\n                `./` +\n                relativePath(\n                  dir,\n                  pathJoin(NEXT_PROJECT_ROOT_DIST_CLIENT, 'dev', 'amp-dev')\n                ).replace(/\\\\/g, '/'),\n            }\n          : {}),\n        [CLIENT_STATIC_FILES_RUNTIME_MAIN]:\n          `./` +\n          path\n            .relative(\n              dir,\n              path.join(\n                NEXT_PROJECT_ROOT_DIST_CLIENT,\n                dev ? `next-dev.js` : 'next.js'\n              )\n            )\n            .replace(/\\\\/g, '/'),\n      } as ClientEntries)\n    : undefined\n\n  let typeScriptPath: string | undefined\n  try {\n    typeScriptPath = require.resolve('typescript', { paths: [dir] })\n  } catch (_) {}\n  const tsConfigPath = path.join(dir, 'tsconfig.json')\n  const useTypeScript = Boolean(\n    typeScriptPath && (await fileExists(tsConfigPath))\n  )\n\n  let jsConfig\n  // jsconfig is a subset of tsconfig\n  if (useTypeScript) {\n    const ts = (await import(typeScriptPath!)) as typeof import('typescript')\n    const tsConfig = await getTypeScriptConfiguration(ts, tsConfigPath, true)\n    jsConfig = { compilerOptions: tsConfig.options }\n  }\n\n  const jsConfigPath = path.join(dir, 'jsconfig.json')\n  if (!useTypeScript && (await fileExists(jsConfigPath))) {\n    jsConfig = parseJsonFile(jsConfigPath)\n  }\n\n  let resolvedBaseUrl\n  if (jsConfig?.compilerOptions?.baseUrl) {\n    resolvedBaseUrl = path.resolve(dir, jsConfig.compilerOptions.baseUrl)\n  }\n\n  function getReactProfilingInProduction() {\n    if (reactProductionProfiling) {\n      return {\n        'react-dom$': 'react-dom/profiling',\n        'scheduler/tracing': 'scheduler/tracing-profiling',\n      }\n    }\n  }\n\n  // tell webpack where to look for _app and _document\n  // using aliases to allow falling back to the default\n  // version when removed or not present\n  const clientResolveRewrites = require.resolve(\n    '../shared/lib/router/utils/resolve-rewrites'\n  )\n  const clientResolveRewritesNoop = require.resolve(\n    '../shared/lib/router/utils/resolve-rewrites-noop'\n  )\n\n  const customAppAliases: { [key: string]: string[] } = {}\n  const customErrorAlias: { [key: string]: string[] } = {}\n  const customDocumentAliases: { [key: string]: string[] } = {}\n\n  if (dev && isWebpack5) {\n    customAppAliases[`${PAGES_DIR_ALIAS}/_app`] = [\n      ...config.pageExtensions.reduce((prev, ext) => {\n        prev.push(path.join(pagesDir, `_app.${ext}`))\n        return prev\n      }, [] as string[]),\n      'next/dist/pages/_app.js',\n    ]\n    customAppAliases[`${PAGES_DIR_ALIAS}/_error`] = [\n      ...config.pageExtensions.reduce((prev, ext) => {\n        prev.push(path.join(pagesDir, `_error.${ext}`))\n        return prev\n      }, [] as string[]),\n      'next/dist/pages/_error.js',\n    ]\n    customDocumentAliases[`${PAGES_DIR_ALIAS}/_document`] = [\n      ...config.pageExtensions.reduce((prev, ext) => {\n        prev.push(path.join(pagesDir, `_document.${ext}`))\n        return prev\n      }, [] as string[]),\n      'next/dist/pages/_document.js',\n    ]\n  }\n\n  const resolveConfig = {\n    // Disable .mjs for node_modules bundling\n    extensions: isServer\n      ? [\n          '.js',\n          '.mjs',\n          ...(useTypeScript ? ['.tsx', '.ts'] : []),\n          '.jsx',\n          '.json',\n          '.wasm',\n        ]\n      : [\n          '.mjs',\n          '.js',\n          ...(useTypeScript ? ['.tsx', '.ts'] : []),\n          '.jsx',\n          '.json',\n          '.wasm',\n        ],\n    modules: [\n      'node_modules',\n      ...nodePathList, // Support for NODE_PATH environment variable\n    ],\n    alias: {\n      next: NEXT_PROJECT_ROOT,\n\n      ...customAppAliases,\n      ...customErrorAlias,\n      ...customDocumentAliases,\n\n      [PAGES_DIR_ALIAS]: pagesDir,\n      [DOT_NEXT_ALIAS]: distDir,\n      ...getOptimizedAliases(isServer),\n      ...getReactProfilingInProduction(),\n      [clientResolveRewrites]: hasRewrites\n        ? clientResolveRewrites\n        : // With webpack 5 an alias can be pointed to false to noop\n        isWebpack5\n        ? false\n        : clientResolveRewritesNoop,\n    },\n    ...(isWebpack5 && !isServer\n      ? {\n          // Full list of old polyfills is accessible here:\n          // https://github.com/webpack/webpack/blob/2a0536cf510768111a3a6dceeb14cb79b9f59273/lib/ModuleNotFoundError.js#L13-L42\n          fallback: {\n            assert: require.resolve('assert/'),\n            buffer: require.resolve('buffer/'),\n            constants: require.resolve('constants-browserify'),\n            crypto: require.resolve('crypto-browserify'),\n            domain: require.resolve('domain-browser'),\n            http: require.resolve('stream-http'),\n            https: require.resolve('https-browserify'),\n            os: require.resolve('os-browserify/browser'),\n            path: require.resolve('path-browserify'),\n            punycode: require.resolve('punycode'),\n            process: require.resolve('process/browser'),\n            // Handled in separate alias\n            querystring: require.resolve('querystring-es3'),\n            stream: require.resolve('stream-browserify'),\n            string_decoder: require.resolve('string_decoder'),\n            sys: require.resolve('util/'),\n            timers: require.resolve('timers-browserify'),\n            tty: require.resolve('tty-browserify'),\n            // Handled in separate alias\n            // url: require.resolve('url/'),\n            util: require.resolve('util/'),\n            vm: require.resolve('vm-browserify'),\n            zlib: require.resolve('browserify-zlib'),\n          },\n        }\n      : undefined),\n    mainFields: isServer ? ['main', 'module'] : ['browser', 'module', 'main'],\n    plugins: isWebpack5\n      ? // webpack 5+ has the PnP resolver built-in by default:\n        []\n      : [require('pnp-webpack-plugin')],\n  }\n\n  const terserOptions: any = {\n    parse: {\n      ecma: 8,\n    },\n    compress: {\n      ecma: 5,\n      warnings: false,\n      // The following two options are known to break valid JavaScript code\n      comparisons: false,\n      inline: 2, // https://github.com/vercel/next.js/issues/7178#issuecomment-493048965\n    },\n    mangle: { safari10: true },\n    output: {\n      ecma: 5,\n      safari10: true,\n      comments: false,\n      // Fixes usage of Emoji and certain Regex\n      ascii_only: true,\n    },\n  }\n\n  const isModuleCSS = (module: { type: string }): boolean => {\n    return (\n      // mini-css-extract-plugin\n      module.type === `css/mini-extract` ||\n      // extract-css-chunks-webpack-plugin (old)\n      module.type === `css/extract-chunks` ||\n      // extract-css-chunks-webpack-plugin (new)\n      module.type === `css/extract-css-chunks`\n    )\n  }\n\n  // Contains various versions of the Webpack SplitChunksPlugin used in different build types\n  const splitChunksConfigs: {\n    [propName: string]: webpack.Options.SplitChunksOptions | false\n  } = {\n    dev: {\n      cacheGroups: {\n        default: false,\n        vendors: false,\n      },\n    },\n    prodGranular: {\n      // Keep main and _app chunks unsplitted in webpack 5\n      // as we don't need a separate vendor chunk from that\n      // and all other chunk depend on them so there is no\n      // duplication that need to be pulled out.\n      chunks: isWebpack5\n        ? (chunk) => !/^(polyfills|main|pages\\/_app)$/.test(chunk.name)\n        : 'all',\n      cacheGroups: {\n        framework: {\n          chunks: 'all',\n          name: 'framework',\n          // This regex ignores nested copies of framework libraries so they're\n          // bundled with their issuer.\n          // https://github.com/vercel/next.js/pull/9012\n          test: /(?<!node_modules.*)[\\\\/]node_modules[\\\\/](react|react-dom|scheduler|prop-types|use-subscription)[\\\\/]/,\n          priority: 40,\n          // Don't let webpack eliminate this chunk (prevents this chunk from\n          // becoming a part of the commons chunk)\n          enforce: true,\n        },\n        lib: {\n          test(module: {\n            size: Function\n            nameForCondition: Function\n          }): boolean {\n            return (\n              module.size() > 160000 &&\n              /node_modules[/\\\\]/.test(module.nameForCondition() || '')\n            )\n          },\n          name(module: {\n            type: string\n            libIdent?: Function\n            updateHash: (hash: crypto.Hash) => void\n          }): string {\n            const hash = crypto.createHash('sha1')\n            if (isModuleCSS(module)) {\n              module.updateHash(hash)\n            } else {\n              if (!module.libIdent) {\n                throw new Error(\n                  `Encountered unknown module type: ${module.type}. Please open an issue.`\n                )\n              }\n\n              hash.update(module.libIdent({ context: dir }))\n            }\n\n            return hash.digest('hex').substring(0, 8)\n          },\n          priority: 30,\n          minChunks: 1,\n          reuseExistingChunk: true,\n        },\n        commons: {\n          name: 'commons',\n          minChunks: totalPages,\n          priority: 20,\n        },\n        ...(isWebpack5\n          ? undefined\n          : {\n              default: false,\n              vendors: false,\n              shared: {\n                name(module, chunks) {\n                  return (\n                    crypto\n                      .createHash('sha1')\n                      .update(\n                        chunks.reduce(\n                          (acc: string, chunk: webpack.compilation.Chunk) => {\n                            return acc + chunk.name\n                          },\n                          ''\n                        )\n                      )\n                      .digest('hex') + (isModuleCSS(module) ? '_CSS' : '')\n                  )\n                },\n                priority: 10,\n                minChunks: 2,\n                reuseExistingChunk: true,\n              },\n            }),\n      },\n      maxInitialRequests: 25,\n      minSize: 20000,\n    },\n  }\n\n  // Select appropriate SplitChunksPlugin config for this build\n  let splitChunksConfig: webpack.Options.SplitChunksOptions | false\n  if (dev) {\n    splitChunksConfig = isWebpack5 ? false : splitChunksConfigs.dev\n  } else {\n    splitChunksConfig = splitChunksConfigs.prodGranular\n  }\n\n  const crossOrigin = config.crossOrigin\n\n  const conformanceConfig = Object.assign(\n    {\n      ReactSyncScriptsConformanceCheck: {\n        enabled: true,\n      },\n      MinificationConformanceCheck: {\n        enabled: true,\n      },\n      DuplicatePolyfillsConformanceCheck: {\n        enabled: true,\n        BlockedAPIToBePolyfilled: Object.assign(\n          [],\n          ['fetch'],\n          config.conformance?.DuplicatePolyfillsConformanceCheck\n            ?.BlockedAPIToBePolyfilled || []\n        ),\n      },\n      GranularChunksConformanceCheck: {\n        enabled: true,\n      },\n    },\n    config.conformance\n  )\n\n  const esmExternals = !!config.experimental?.esmExternals\n  const looseEsmExternals = config.experimental?.esmExternals === 'loose'\n\n  async function handleExternals(\n    context: string,\n    request: string,\n    dependencyType: string,\n    getResolve: (\n      options: any\n    ) => (\n      resolveContext: string,\n      resolveRequest: string\n    ) => Promise<[string | null, boolean]>\n  ) {\n    // We need to externalize internal requests for files intended to\n    // not be bundled.\n\n    const isLocal: boolean =\n      request.startsWith('.') ||\n      // Always check for unix-style path, as webpack sometimes\n      // normalizes as posix.\n      path.posix.isAbsolute(request) ||\n      // When on Windows, we also want to check for Windows-specific\n      // absolute paths.\n      (process.platform === 'win32' && path.win32.isAbsolute(request))\n\n    // Relative requires don't need custom resolution, because they\n    // are relative to requests we've already resolved here.\n    // Absolute requires (require('/foo')) are extremely uncommon, but\n    // also have no need for customization as they're already resolved.\n    if (!isLocal) {\n      if (/^(?:next$|react(?:$|\\/))/.test(request)) {\n        return `commonjs ${request}`\n      }\n\n      const notExternalModules =\n        /^(?:private-next-pages\\/|next\\/(?:dist\\/pages\\/|(?:app|document|link|image|constants|dynamic)$)|string-hash$)/\n      if (notExternalModules.test(request)) {\n        return\n      }\n    }\n\n    // When in esm externals mode, and using import, we resolve with\n    // ESM resolving options.\n    const isEsmRequested = dependencyType === 'esm'\n    const preferEsm = esmExternals && isEsmRequested\n\n    const resolve = getResolve(\n      preferEsm ? WEBPACK_ESM_RESOLVE_OPTIONS : WEBPACK_RESOLVE_OPTIONS\n    )\n\n    // Resolve the import with the webpack provided context, this\n    // ensures we're resolving the correct version when multiple\n    // exist.\n    let res: string | null\n    let isEsm: boolean = false\n    try {\n      ;[res, isEsm] = await resolve(context, request)\n    } catch (err) {\n      res = null\n    }\n\n    // If resolving fails, and we can use an alternative way\n    // try the alternative resolving options.\n    if (!res && (isEsmRequested || looseEsmExternals)) {\n      const resolveAlternative = getResolve(\n        preferEsm ? WEBPACK_RESOLVE_OPTIONS : WEBPACK_ESM_RESOLVE_OPTIONS\n      )\n      try {\n        ;[res, isEsm] = await resolveAlternative(context, request)\n      } catch (err) {\n        res = null\n      }\n    }\n\n    // If the request cannot be resolved we need to have\n    // webpack \"bundle\" it so it surfaces the not found error.\n    if (!res) {\n      return\n    }\n\n    // ESM externals can only be imported (and not required).\n    // Make an exception in loose mode.\n    if (!isEsmRequested && isEsm && !looseEsmExternals) {\n      throw new Error(\n        `ESM packages (${request}) need to be imported. Use 'import' to reference the package instead. https://nextjs.org/docs/messages/import-esm-externals`\n      )\n    }\n\n    if (isLocal) {\n      // Makes sure dist/shared and dist/server are not bundled\n      // we need to process shared `router/router` and `dynamic`,\n      // so that the DefinePlugin can inject process.env values\n      const isNextExternal =\n        /next[/\\\\]dist[/\\\\](shared|server)[/\\\\](?!lib[/\\\\](router[/\\\\]router|dynamic))/.test(\n          res\n        )\n\n      if (isNextExternal) {\n        // Generate Next.js external import\n        const externalRequest = path.posix.join(\n          'next',\n          'dist',\n          path\n            .relative(\n              // Root of Next.js package:\n              path.join(__dirname, '..'),\n              res\n            )\n            // Windows path normalization\n            .replace(/\\\\/g, '/')\n        )\n        return `commonjs ${externalRequest}`\n      } else {\n        return\n      }\n    }\n\n    // Bundled Node.js code is relocated without its node_modules tree.\n    // This means we need to make sure its request resolves to the same\n    // package that'll be available at runtime. If it's not identical,\n    // we need to bundle the code (even if it _should_ be external).\n    let baseRes: string | null\n    let baseIsEsm: boolean\n    try {\n      const baseResolve = getResolve(\n        isEsm ? NODE_ESM_RESOLVE_OPTIONS : NODE_RESOLVE_OPTIONS\n      )\n      ;[baseRes, baseIsEsm] = await baseResolve(dir, request)\n    } catch (err) {\n      baseRes = null\n      baseIsEsm = false\n    }\n\n    // Same as above: if the package, when required from the root,\n    // would be different from what the real resolution would use, we\n    // cannot externalize it.\n    // if request is pointing to a symlink it could point to the the same file,\n    // the resolver will resolve symlinks so this is handled\n    if (baseRes !== res || isEsm !== baseIsEsm) {\n      return\n    }\n\n    const externalType = isEsm ? 'module' : 'commonjs'\n\n    if (\n      res.match(/next[/\\\\]dist[/\\\\]shared[/\\\\](?!lib[/\\\\]router[/\\\\]router)/)\n    ) {\n      return `${externalType} ${request}`\n    }\n\n    // Default pages have to be transpiled\n    if (\n      res.match(/[/\\\\]next[/\\\\]dist[/\\\\]/) ||\n      // This is the @babel/plugin-transform-runtime \"helpers: true\" option\n      res.match(/node_modules[/\\\\]@babel[/\\\\]runtime[/\\\\]/)\n    ) {\n      return\n    }\n\n    // Webpack itself has to be compiled because it doesn't always use module relative paths\n    if (\n      res.match(/node_modules[/\\\\]webpack/) ||\n      res.match(/node_modules[/\\\\]css-loader/)\n    ) {\n      return\n    }\n\n    // Anything else that is standard JavaScript within `node_modules`\n    // can be externalized.\n    if (/node_modules[/\\\\].*\\.c?js$/.test(res)) {\n      return `${externalType} ${request}`\n    }\n\n    // Default behavior: bundle the code!\n  }\n\n  const emacsLockfilePattern = '**/.#*'\n\n  let webpackConfig: webpack.Configuration = {\n    parallelism: Number(process.env.NEXT_WEBPACK_PARALLELISM) || undefined,\n    externals: !isServer\n      ? // make sure importing \"next\" is handled gracefully for client\n        // bundles in case a user imported types and it wasn't removed\n        // TODO: should we warn/error for this instead?\n        ['next']\n      : !isServerless\n      ? [\n          isWebpack5\n            ? ({\n                context,\n                request,\n                dependencyType,\n                getResolve,\n              }: {\n                context: string\n                request: string\n                dependencyType: string\n                getResolve: (\n                  options: any\n                ) => (\n                  resolveContext: string,\n                  resolveRequest: string,\n                  callback: (\n                    err?: Error,\n                    result?: string,\n                    resolveData?: { descriptionFileData?: { type?: any } }\n                  ) => void\n                ) => void\n              }) =>\n                handleExternals(context, request, dependencyType, (options) => {\n                  const resolveFunction = getResolve(options)\n                  return (resolveContext: string, requestToResolve: string) =>\n                    new Promise((resolve, reject) => {\n                      resolveFunction(\n                        resolveContext,\n                        requestToResolve,\n                        (err, result, resolveData) => {\n                          if (err) return reject(err)\n                          if (!result) return resolve([null, false])\n                          const isEsm = /\\.js$/i.test(result)\n                            ? resolveData?.descriptionFileData?.type ===\n                              'module'\n                            : /\\.mjs$/i.test(result)\n                          resolve([result, isEsm])\n                        }\n                      )\n                    })\n                })\n            : (\n                context: string,\n                request: string,\n                callback: (err?: Error, result?: string | undefined) => void\n              ) =>\n                handleExternals(\n                  context,\n                  request,\n                  'commonjs',\n                  () => (resolveContext: string, requestToResolve: string) =>\n                    new Promise((resolve) =>\n                      resolve([\n                        require.resolve(requestToResolve, {\n                          paths: [resolveContext],\n                        }),\n                        false,\n                      ])\n                    )\n                ).then((result) => callback(undefined, result), callback),\n        ]\n      : [\n          // When the 'serverless' target is used all node_modules will be compiled into the output bundles\n          // So that the 'serverless' bundles have 0 runtime dependencies\n          'next/dist/compiled/@ampproject/toolbox-optimizer', // except this one\n\n          // Mark this as external if not enabled so it doesn't cause a\n          // webpack error from being missing\n          ...(config.experimental.optimizeCss ? [] : ['critters']),\n        ],\n    optimization: {\n      // Webpack 5 uses a new property for the same functionality\n      ...(isWebpack5 ? { emitOnErrors: !dev } : { noEmitOnErrors: dev }),\n      checkWasmTypes: false,\n      nodeEnv: false,\n      splitChunks: isServer\n        ? isWebpack5 && !dev\n          ? ({\n              filename: '[name].js',\n              // allow to split entrypoints\n              chunks: 'all',\n              // size of files is not so relevant for server build\n              // we want to prefer deduplication to load less code\n              minSize: 1000,\n            } as any)\n          : false\n        : splitChunksConfig,\n      runtimeChunk: isServer\n        ? isWebpack5 && !isLikeServerless\n          ? { name: 'webpack-runtime' }\n          : undefined\n        : { name: CLIENT_STATIC_FILES_RUNTIME_WEBPACK },\n      minimize: !(dev || isServer),\n      minimizer: [\n        // Minify JavaScript\n        (compiler: webpack.Compiler) => {\n          // @ts-ignore No typings yet\n          const {\n            TerserPlugin,\n          } = require('./webpack/plugins/terser-webpack-plugin/src/index.js')\n          new TerserPlugin({\n            cacheDir: path.join(distDir, 'cache', 'next-minifier'),\n            parallel: config.experimental.cpus,\n            swcMinify: config.experimental.swcMinify,\n            terserOptions,\n          }).apply(compiler)\n        },\n        // Minify CSS\n        (compiler: webpack.Compiler) => {\n          const {\n            CssMinimizerPlugin,\n          } = require('./webpack/plugins/css-minimizer-plugin')\n          new CssMinimizerPlugin({\n            postcssOptions: {\n              map: {\n                // `inline: false` generates the source map in a separate file.\n                // Otherwise, the CSS file is needlessly large.\n                inline: false,\n                // `annotation: false` skips appending the `sourceMappingURL`\n                // to the end of the CSS file. Webpack already handles this.\n                annotation: false,\n              },\n            },\n          }).apply(compiler)\n        },\n      ],\n    },\n    context: dir,\n    node: {\n      setImmediate: false,\n    },\n    // Kept as function to be backwards compatible\n    // @ts-ignore TODO webpack 5 typings needed\n    entry: async () => {\n      return {\n        ...(clientEntries ? clientEntries : {}),\n        ...entrypoints,\n      }\n    },\n    watchOptions: {\n      aggregateTimeout: 5,\n      ignored: [\n        '**/.git/**',\n        '**/node_modules/**',\n        '**/.next/**',\n        // can be removed after https://github.com/paulmillr/chokidar/issues/955 is released\n        emacsLockfilePattern,\n      ],\n    },\n    output: {\n      // we must set publicPath to an empty value to override the default of\n      // auto which doesn't work in IE11\n      publicPath: `${config.assetPrefix || ''}/_next/`,\n      path:\n        isServer && isWebpack5 && !dev\n          ? path.join(outputPath, 'chunks')\n          : outputPath,\n      // On the server we don't use hashes\n      filename: isServer\n        ? isWebpack5 && !dev\n          ? '../[name].js'\n          : '[name].js'\n        : `static/chunks/${isDevFallback ? 'fallback/' : ''}[name]${\n            dev ? '' : isWebpack5 ? '-[contenthash]' : '-[chunkhash]'\n          }.js`,\n      library: isServer ? undefined : '_N_E',\n      libraryTarget: isServer ? 'commonjs2' : 'assign',\n      hotUpdateChunkFilename: isWebpack5\n        ? 'static/webpack/[id].[fullhash].hot-update.js'\n        : 'static/webpack/[id].[hash].hot-update.js',\n      hotUpdateMainFilename: isWebpack5\n        ? 'static/webpack/[fullhash].[runtime].hot-update.json'\n        : 'static/webpack/[hash].hot-update.json',\n      // This saves chunks with the name given via `import()`\n      chunkFilename: isServer\n        ? '[name].js'\n        : `static/chunks/${isDevFallback ? 'fallback/' : ''}${\n            dev ? '[name]' : '[name].[contenthash]'\n          }.js`,\n      strictModuleExceptionHandling: true,\n      crossOriginLoading: crossOrigin,\n      futureEmitAssets: !dev,\n      webassemblyModuleFilename: 'static/wasm/[modulehash].wasm',\n    },\n    performance: false,\n    resolve: resolveConfig,\n    resolveLoader: {\n      // The loaders Next.js provides\n      alias: [\n        'emit-file-loader',\n        'error-loader',\n        'next-babel-loader',\n        'next-swc-loader',\n        'next-client-pages-loader',\n        'next-image-loader',\n        'next-serverless-loader',\n        'noop-loader',\n        'next-style-loader',\n      ].reduce((alias, loader) => {\n        // using multiple aliases to replace `resolveLoader.modules`\n        alias[loader] = path.join(__dirname, 'webpack', 'loaders', loader)\n\n        return alias\n      }, {} as Record<string, string>),\n      modules: [\n        'node_modules',\n        ...nodePathList, // Support for NODE_PATH environment variable\n      ],\n      plugins: isWebpack5 ? [] : [require('pnp-webpack-plugin')],\n    },\n    module: {\n      rules: [\n        ...(isWebpack5\n          ? [\n              // TODO: FIXME: do NOT webpack 5 support with this\n              // x-ref: https://github.com/webpack/webpack/issues/11467\n              {\n                test: /\\.m?js/,\n                resolve: {\n                  fullySpecified: false,\n                },\n              } as any,\n            ]\n          : []),\n        {\n          test: /\\.(tsx|ts|js|mjs|jsx)$/,\n          ...(config.experimental.externalDir\n            ? // Allowing importing TS/TSX files from outside of the root dir.\n              {}\n            : { include: [dir, ...babelIncludeRegexes] }),\n          exclude: (excludePath: string) => {\n            if (babelIncludeRegexes.some((r) => r.test(excludePath))) {\n              return false\n            }\n            return /node_modules/.test(excludePath)\n          },\n          use: hasReactRefresh\n            ? [\n                require.resolve('@next/react-refresh-utils/loader'),\n                defaultLoaders.babel,\n              ]\n            : defaultLoaders.babel,\n        },\n        ...(!config.images.disableStaticImages && isWebpack5\n          ? [\n              {\n                test: /\\.(png|jpg|jpeg|gif|webp|ico|bmp|svg)$/i,\n                loader: 'next-image-loader',\n                issuer: { not: regexLikeCss },\n                dependency: { not: ['url'] },\n                options: {\n                  isServer,\n                  isDev: dev,\n                  assetPrefix: config.assetPrefix,\n                },\n              },\n            ]\n          : []),\n      ].filter(Boolean),\n    },\n    plugins: [\n      hasReactRefresh && new ReactRefreshWebpackPlugin(webpack),\n      // Makes sure `Buffer` and `process` are polyfilled in client-side bundles (same behavior as webpack 4)\n      isWebpack5 &&\n        !isServer &&\n        new webpack.ProvidePlugin({\n          Buffer: [require.resolve('buffer'), 'Buffer'],\n          process: [require.resolve('process')],\n        }),\n      // This plugin makes sure `output.filename` is used for entry chunks\n      !isWebpack5 && new ChunkNamesPlugin(),\n      new webpack.DefinePlugin({\n        ...Object.keys(process.env).reduce(\n          (prev: { [key: string]: string }, key: string) => {\n            if (key.startsWith('NEXT_PUBLIC_')) {\n              prev[`process.env.${key}`] = JSON.stringify(process.env[key]!)\n            }\n            return prev\n          },\n          {}\n        ),\n        ...Object.keys(config.env).reduce((acc, key) => {\n          if (/^(?:NODE_.+)|^(?:__.+)$/i.test(key)) {\n            throw new Error(\n              `The key \"${key}\" under \"env\" in next.config.js is not allowed. https://nextjs.org/docs/messages/env-key-not-allowed`\n            )\n          }\n\n          return {\n            ...acc,\n            [`process.env.${key}`]: JSON.stringify(config.env[key]),\n          }\n        }, {}),\n        // TODO: enforce `NODE_ENV` on `process.env`, and add a test:\n        'process.env.NODE_ENV': JSON.stringify(\n          dev ? 'development' : 'production'\n        ),\n        'process.env.__NEXT_CROSS_ORIGIN': JSON.stringify(crossOrigin),\n        'process.browser': JSON.stringify(!isServer),\n        'process.env.__NEXT_TEST_MODE': JSON.stringify(\n          process.env.__NEXT_TEST_MODE\n        ),\n        // This is used in client/dev-error-overlay/hot-dev-client.js to replace the dist directory\n        ...(dev && !isServer\n          ? {\n              'process.env.__NEXT_DIST_DIR': JSON.stringify(distDir),\n            }\n          : {}),\n        'process.env.__NEXT_TRAILING_SLASH': JSON.stringify(\n          config.trailingSlash\n        ),\n        'process.env.__NEXT_BUILD_INDICATOR': JSON.stringify(\n          config.devIndicators.buildActivity\n        ),\n        'process.env.__NEXT_PLUGINS': JSON.stringify(\n          config.experimental.plugins\n        ),\n        'process.env.__NEXT_STRICT_MODE': JSON.stringify(\n          config.reactStrictMode\n        ),\n        'process.env.__NEXT_REACT_ROOT': JSON.stringify(hasReactRoot),\n        'process.env.__NEXT_CONCURRENT_FEATURES': JSON.stringify(\n          config.experimental.concurrentFeatures && hasReactRoot\n        ),\n        'process.env.__NEXT_OPTIMIZE_FONTS': JSON.stringify(\n          config.optimizeFonts && !dev\n        ),\n        'process.env.__NEXT_OPTIMIZE_IMAGES': JSON.stringify(\n          config.experimental.optimizeImages\n        ),\n        'process.env.__NEXT_OPTIMIZE_CSS': JSON.stringify(\n          config.experimental.optimizeCss && !dev\n        ),\n        'process.env.__NEXT_SCROLL_RESTORATION': JSON.stringify(\n          config.experimental.scrollRestoration\n        ),\n        'process.env.__NEXT_IMAGE_OPTS': JSON.stringify({\n          deviceSizes: config.images.deviceSizes,\n          imageSizes: config.images.imageSizes,\n          path: config.images.path,\n          loader: config.images.loader,\n          ...(dev\n            ? {\n                // pass domains in development to allow validating on the client\n                domains: config.images.domains,\n              }\n            : {}),\n        }),\n        'process.env.__NEXT_ROUTER_BASEPATH': JSON.stringify(config.basePath),\n        'process.env.__NEXT_HAS_REWRITES': JSON.stringify(hasRewrites),\n        'process.env.__NEXT_I18N_SUPPORT': JSON.stringify(!!config.i18n),\n        'process.env.__NEXT_I18N_DOMAINS': JSON.stringify(config.i18n?.domains),\n        'process.env.__NEXT_ANALYTICS_ID': JSON.stringify(config.analyticsId),\n        ...(isServer\n          ? {\n              // Fix bad-actors in the npm ecosystem (e.g. `node-formidable`)\n              // This is typically found in unmaintained modules from the\n              // pre-webpack era (common in server-side code)\n              'global.GENTLY': JSON.stringify(false),\n            }\n          : undefined),\n        // stub process.env with proxy to warn a missing value is\n        // being accessed in development mode\n        ...(config.experimental.pageEnv && dev\n          ? {\n              'process.env': `\n            new Proxy(${isServer ? 'process.env' : '{}'}, {\n              get(target, prop) {\n                if (typeof target[prop] === 'undefined') {\n                  console.warn(\\`An environment variable (\\${prop}) that was not provided in the environment was accessed.\\nSee more info here: https://nextjs.org/docs/messages/missing-env-value\\`)\n                }\n                return target[prop]\n              }\n            })\n          `,\n            }\n          : {}),\n      }),\n      !isServer &&\n        new ReactLoadablePlugin({\n          filename: REACT_LOADABLE_MANIFEST,\n          pagesDir,\n        }),\n      !isServer && new DropClientPage(),\n      config.experimental.nftTracing &&\n        !isLikeServerless &&\n        isServer &&\n        !dev &&\n        isWebpack5 &&\n        new TraceEntryPointsPlugin({ appDir: dir }),\n      // Moment.js is an extremely popular library that bundles large locale files\n      // by default due to how Webpack interprets its code. This is a practical\n      // solution that requires the user to opt into importing specific locales.\n      // https://github.com/jmblog/how-to-optimize-momentjs-with-webpack\n      config.excludeDefaultMomentLocales &&\n        new webpack.IgnorePlugin({\n          resourceRegExp: /^\\.\\/locale$/,\n          contextRegExp: /moment$/,\n        }),\n      ...(dev\n        ? (() => {\n            // Even though require.cache is server only we have to clear assets from both compilations\n            // This is because the client compilation generates the build manifest that's used on the server side\n            const {\n              NextJsRequireCacheHotReloader,\n            } = require('./webpack/plugins/nextjs-require-cache-hot-reloader')\n            const devPlugins = [new NextJsRequireCacheHotReloader()]\n\n            if (!isServer) {\n              devPlugins.push(new webpack.HotModuleReplacementPlugin())\n            }\n\n            return devPlugins\n          })()\n        : []),\n      // Webpack 5 no longer requires this plugin in production:\n      !isWebpack5 && !dev && new webpack.HashedModuleIdsPlugin(),\n      !dev &&\n        new webpack.IgnorePlugin({\n          resourceRegExp: /react-is/,\n          contextRegExp: /next[\\\\/]dist[\\\\/]/,\n        }),\n      isServerless && isServer && new ServerlessPlugin(),\n      isServer &&\n        new PagesManifestPlugin({ serverless: isLikeServerless, dev }),\n      !isWebpack5 &&\n        target === 'server' &&\n        isServer &&\n        new NextJsSSRModuleCachePlugin({ outputPath }),\n      isServer && new NextJsSsrImportPlugin(),\n      !isServer &&\n        new BuildManifestPlugin({\n          buildId,\n          rewrites,\n          isDevFallback,\n        }),\n      !dev &&\n        !isServer &&\n        config.experimental.stats &&\n        new BuildStatsPlugin({\n          distDir,\n        }),\n      new ProfilingPlugin({ runWebpackSpan }),\n      config.optimizeFonts &&\n        !dev &&\n        isServer &&\n        (function () {\n          const { FontStylesheetGatheringPlugin } =\n            require('./webpack/plugins/font-stylesheet-gathering-plugin') as {\n              FontStylesheetGatheringPlugin: typeof import('./webpack/plugins/font-stylesheet-gathering-plugin').FontStylesheetGatheringPlugin\n            }\n          return new FontStylesheetGatheringPlugin({\n            isLikeServerless,\n          })\n        })(),\n      config.experimental.conformance &&\n        !isWebpack5 &&\n        !dev &&\n        new WebpackConformancePlugin({\n          tests: [\n            !isServer &&\n              conformanceConfig.MinificationConformanceCheck.enabled &&\n              new MinificationConformanceCheck(),\n            conformanceConfig.ReactSyncScriptsConformanceCheck.enabled &&\n              new ReactSyncScriptsConformanceCheck({\n                AllowedSources:\n                  conformanceConfig.ReactSyncScriptsConformanceCheck\n                    .allowedSources || [],\n              }),\n            !isServer &&\n              conformanceConfig.DuplicatePolyfillsConformanceCheck.enabled &&\n              new DuplicatePolyfillsConformanceCheck({\n                BlockedAPIToBePolyfilled:\n                  conformanceConfig.DuplicatePolyfillsConformanceCheck\n                    .BlockedAPIToBePolyfilled,\n              }),\n            !isServer &&\n              conformanceConfig.GranularChunksConformanceCheck.enabled &&\n              new GranularChunksConformanceCheck(\n                splitChunksConfigs.prodGranular\n              ),\n          ].filter(Boolean),\n        }),\n      new WellKnownErrorsPlugin(),\n      !isServer &&\n        new CopyFilePlugin({\n          filePath: require.resolve('./polyfills/polyfill-nomodule'),\n          cacheKey: process.env.__NEXT_VERSION as string,\n          name: `static/chunks/polyfills${dev ? '' : '-[hash]'}.js`,\n          minimize: false,\n          info: {\n            [CLIENT_STATIC_FILES_RUNTIME_POLYFILLS_SYMBOL]: 1,\n            // This file is already minified\n            minimized: true,\n          },\n        }),\n    ].filter(Boolean as any as ExcludesFalse),\n  }\n\n  // Support tsconfig and jsconfig baseUrl\n  if (resolvedBaseUrl) {\n    webpackConfig.resolve?.modules?.push(resolvedBaseUrl)\n  }\n\n  if (jsConfig?.compilerOptions?.paths && resolvedBaseUrl) {\n    webpackConfig.resolve?.plugins?.unshift(\n      new JsConfigPathsPlugin(jsConfig.compilerOptions.paths, resolvedBaseUrl)\n    )\n  }\n\n  if (isWebpack5) {\n    // futureEmitAssets is on by default in webpack 5\n    delete webpackConfig.output?.futureEmitAssets\n\n    if (isServer && dev) {\n      // Enable building of client compilation before server compilation in development\n      // @ts-ignore dependencies exists\n      webpackConfig.dependencies = ['client']\n    }\n    // webpack 5 no longer polyfills Node.js modules:\n    if (webpackConfig.node) delete webpackConfig.node.setImmediate\n\n    // Due to bundling of webpack the default values can't be correctly detected\n    // This restores the webpack defaults\n    // @ts-ignore webpack 5\n    webpackConfig.snapshot = {}\n    if (process.versions.pnp === '3') {\n      const match =\n        /^(.+?)[\\\\/]cache[\\\\/]jest-worker-npm-[^\\\\/]+\\.zip[\\\\/]node_modules[\\\\/]/.exec(\n          require.resolve('jest-worker')\n        )\n      if (match) {\n        // @ts-ignore webpack 5\n        webpackConfig.snapshot.managedPaths = [\n          path.resolve(match[1], 'unplugged'),\n        ]\n      }\n    } else {\n      const match = /^(.+?[\\\\/]node_modules)[\\\\/]/.exec(\n        require.resolve('jest-worker')\n      )\n      if (match) {\n        // @ts-ignore webpack 5\n        webpackConfig.snapshot.managedPaths = [match[1]]\n      }\n    }\n    if (process.versions.pnp === '1') {\n      const match =\n        /^(.+?[\\\\/]v4)[\\\\/]npm-jest-worker-[^\\\\/]+-[\\da-f]{40}[\\\\/]node_modules[\\\\/]/.exec(\n          require.resolve('jest-worker')\n        )\n      if (match) {\n        // @ts-ignore webpack 5\n        webpackConfig.snapshot.immutablePaths = [match[1]]\n      }\n    } else if (process.versions.pnp === '3') {\n      const match =\n        /^(.+?)[\\\\/]jest-worker-npm-[^\\\\/]+\\.zip[\\\\/]node_modules[\\\\/]/.exec(\n          require.resolve('jest-worker')\n        )\n      if (match) {\n        // @ts-ignore webpack 5\n        webpackConfig.snapshot.immutablePaths = [match[1]]\n      }\n    }\n\n    if (dev) {\n      if (!webpackConfig.optimization) {\n        webpackConfig.optimization = {}\n      }\n      webpackConfig.optimization.providedExports = false\n      webpackConfig.optimization.usedExports = false\n    }\n\n    const configVars = JSON.stringify({\n      crossOrigin: config.crossOrigin,\n      pageExtensions: config.pageExtensions,\n      trailingSlash: config.trailingSlash,\n      buildActivity: config.devIndicators.buildActivity,\n      productionBrowserSourceMaps: !!config.productionBrowserSourceMaps,\n      plugins: config.experimental.plugins,\n      reactStrictMode: config.reactStrictMode,\n      reactMode: config.experimental.reactMode,\n      optimizeFonts: config.optimizeFonts,\n      optimizeImages: config.experimental.optimizeImages,\n      optimizeCss: config.experimental.optimizeCss,\n      scrollRestoration: config.experimental.scrollRestoration,\n      basePath: config.basePath,\n      pageEnv: config.experimental.pageEnv,\n      excludeDefaultMomentLocales: config.excludeDefaultMomentLocales,\n      assetPrefix: config.assetPrefix,\n      disableOptimizedLoading: config.experimental.disableOptimizedLoading,\n      target,\n      reactProductionProfiling,\n      webpack: !!config.webpack,\n      hasRewrites,\n      reactRoot: config.experimental.reactRoot,\n      concurrentFeatures: config.experimental.concurrentFeatures,\n    })\n\n    const cache: any = {\n      type: 'filesystem',\n      // Includes:\n      //  - Next.js version\n      //  - next.config.js keys that affect compilation\n      version: `${process.env.__NEXT_VERSION}|${configVars}`,\n      cacheDirectory: path.join(distDir, 'cache', 'webpack'),\n    }\n\n    // Adds `next.config.js` as a buildDependency when custom webpack config is provided\n    if (config.webpack && config.configFile) {\n      cache.buildDependencies = {\n        config: [config.configFile],\n      }\n    }\n\n    webpackConfig.cache = cache\n\n    if (process.env.NEXT_WEBPACK_LOGGING) {\n      const logInfra =\n        process.env.NEXT_WEBPACK_LOGGING.includes('infrastructure')\n      const logProfileClient =\n        process.env.NEXT_WEBPACK_LOGGING.includes('profile-client')\n      const logProfileServer =\n        process.env.NEXT_WEBPACK_LOGGING.includes('profile-server')\n      const logDefault = !logInfra && !logProfileClient && !logProfileServer\n\n      if (logDefault || logInfra) {\n        // @ts-ignore TODO: remove ignore when webpack 5 is stable\n        webpackConfig.infrastructureLogging = {\n          level: 'verbose',\n          debug: /FileSystemInfo/,\n        }\n      }\n\n      if (\n        logDefault ||\n        (logProfileClient && !isServer) ||\n        (logProfileServer && isServer)\n      ) {\n        webpackConfig.plugins!.push((compiler: webpack.Compiler) => {\n          compiler.hooks.done.tap('next-webpack-logging', (stats) => {\n            console.log(\n              stats.toString({\n                colors: true,\n                // @ts-ignore TODO: remove ignore when webpack 5 is stable\n                logging: logDefault ? 'log' : 'verbose',\n              })\n            )\n          })\n        })\n      }\n\n      if ((logProfileClient && !isServer) || (logProfileServer && isServer)) {\n        webpackConfig.plugins!.push(\n          new webpack.ProgressPlugin({\n            // @ts-ignore TODO: remove ignore when webpack 5 is stable\n            profile: true,\n          })\n        )\n        webpackConfig.profile = true\n      }\n    }\n  }\n\n  webpackConfig = await buildConfiguration(webpackConfig, {\n    rootDirectory: dir,\n    customAppFile: new RegExp(\n      path.join(pagesDir, `_app`).replace(/\\\\/g, '(/|\\\\\\\\)')\n    ),\n    isDevelopment: dev,\n    isServer,\n    assetPrefix: config.assetPrefix || '',\n    sassOptions: config.sassOptions,\n    productionBrowserSourceMaps: config.productionBrowserSourceMaps,\n    future: config.future,\n    isCraCompat: config.experimental.craCompat,\n  })\n\n  let originalDevtool = webpackConfig.devtool\n  if (typeof config.webpack === 'function') {\n    webpackConfig = config.webpack(webpackConfig, {\n      dir,\n      dev,\n      isServer,\n      buildId,\n      config,\n      defaultLoaders,\n      totalPages,\n      webpack,\n    })\n\n    if (!webpackConfig) {\n      throw new Error(\n        'Webpack config is undefined. You may have forgot to return properly from within the \"webpack\" method of your next.config.js.\\n' +\n          'See more info here https://nextjs.org/docs/messages/undefined-webpack-config'\n      )\n    }\n\n    if (dev && originalDevtool !== webpackConfig.devtool) {\n      webpackConfig.devtool = originalDevtool\n      devtoolRevertWarning(originalDevtool)\n    }\n\n    if (typeof (webpackConfig as any).then === 'function') {\n      console.warn(\n        '> Promise returned in next config. https://nextjs.org/docs/messages/promise-in-next-config'\n      )\n    }\n  }\n\n  if (!config.images.disableStaticImages && isWebpack5) {\n    const rules = webpackConfig.module?.rules || []\n    const hasCustomSvg = rules.some(\n      (rule) =>\n        rule.loader !== 'next-image-loader' &&\n        'test' in rule &&\n        rule.test instanceof RegExp &&\n        rule.test.test('.svg')\n    )\n    const nextImageRule = rules.find(\n      (rule) => rule.loader === 'next-image-loader'\n    )\n    if (hasCustomSvg && nextImageRule) {\n      // Exclude svg if the user already defined it in custom\n      // webpack config such as `@svgr/webpack` plugin or\n      // the `babel-plugin-inline-react-svg` plugin.\n      nextImageRule.test = /\\.(png|jpg|jpeg|gif|webp|ico|bmp)$/i\n    }\n  }\n\n  if (\n    config.experimental.craCompat &&\n    webpackConfig.module?.rules &&\n    webpackConfig.plugins\n  ) {\n    // CRA prevents loading all locales by default\n    // https://github.com/facebook/create-react-app/blob/fddce8a9e21bf68f37054586deb0c8636a45f50b/packages/react-scripts/config/webpack.config.js#L721\n    webpackConfig.plugins.push(\n      new webpack.IgnorePlugin(/^\\.\\/locale$/, /moment$/)\n    )\n\n    // CRA allows importing non-webpack handled files with file-loader\n    // these need to be the last rule to prevent catching other items\n    // https://github.com/facebook/create-react-app/blob/fddce8a9e21bf68f37054586deb0c8636a45f50b/packages/react-scripts/config/webpack.config.js#L594\n    const fileLoaderExclude = [/\\.(js|mjs|jsx|ts|tsx|json)$/]\n    const fileLoader = isWebpack5\n      ? {\n          exclude: fileLoaderExclude,\n          issuer: fileLoaderExclude,\n          type: 'asset/resource',\n          generator: {\n            publicPath: '/_next/',\n            filename: 'static/media/[name].[hash:8].[ext]',\n          },\n        }\n      : {\n          loader: require.resolve('next/dist/compiled/file-loader'),\n          // Exclude `js` files to keep \"css\" loader working as it injects\n          // its runtime that would otherwise be processed through \"file\" loader.\n          // Also exclude `html` and `json` extensions so they get processed\n          // by webpacks internal loaders.\n          exclude: fileLoaderExclude,\n          issuer: fileLoaderExclude,\n          options: {\n            publicPath: '/_next/static/media',\n            outputPath: 'static/media',\n            name: '[name].[hash:8].[ext]',\n          },\n        }\n\n    const topRules = []\n    const innerRules = []\n\n    for (const rule of webpackConfig.module.rules) {\n      if (rule.resolve) {\n        topRules.push(rule)\n      } else {\n        if (\n          rule.oneOf &&\n          !(rule.test || rule.exclude || rule.resource || rule.issuer)\n        ) {\n          rule.oneOf.forEach((r) => innerRules.push(r))\n        } else {\n          innerRules.push(rule)\n        }\n      }\n    }\n\n    webpackConfig.module.rules = [\n      ...(topRules as any),\n      {\n        oneOf: [...innerRules, fileLoader],\n      },\n    ]\n  }\n\n  // Backwards compat with webpack-dev-middleware options object\n  if (typeof config.webpackDevMiddleware === 'function') {\n    const options = config.webpackDevMiddleware({\n      watchOptions: webpackConfig.watchOptions,\n    })\n    if (options.watchOptions) {\n      webpackConfig.watchOptions = options.watchOptions\n    }\n  }\n\n  function canMatchCss(rule: webpack.RuleSetCondition | undefined): boolean {\n    if (!rule) {\n      return false\n    }\n\n    const fileNames = [\n      '/tmp/test.css',\n      '/tmp/test.scss',\n      '/tmp/test.sass',\n      '/tmp/test.less',\n      '/tmp/test.styl',\n    ]\n\n    if (rule instanceof RegExp && fileNames.some((input) => rule.test(input))) {\n      return true\n    }\n\n    if (typeof rule === 'function') {\n      if (\n        fileNames.some((input) => {\n          try {\n            if (rule(input)) {\n              return true\n            }\n          } catch (_) {}\n          return false\n        })\n      ) {\n        return true\n      }\n    }\n\n    if (Array.isArray(rule) && rule.some(canMatchCss)) {\n      return true\n    }\n\n    return false\n  }\n\n  const hasUserCssConfig =\n    webpackConfig.module?.rules.some(\n      (rule) => canMatchCss(rule.test) || canMatchCss(rule.include)\n    ) ?? false\n\n  if (hasUserCssConfig) {\n    // only show warning for one build\n    if (isServer) {\n      console.warn(\n        chalk.yellow.bold('Warning: ') +\n          chalk.bold(\n            'Built-in CSS support is being disabled due to custom CSS configuration being detected.\\n'\n          ) +\n          'See here for more info: https://nextjs.org/docs/messages/built-in-css-disabled\\n'\n      )\n    }\n\n    if (webpackConfig.module?.rules.length) {\n      // Remove default CSS Loader\n      webpackConfig.module.rules = webpackConfig.module.rules.filter(\n        (r) =>\n          !(\n            typeof r.oneOf?.[0]?.options === 'object' &&\n            r.oneOf[0].options.__next_css_remove === true\n          )\n      )\n    }\n    if (webpackConfig.plugins?.length) {\n      // Disable CSS Extraction Plugin\n      webpackConfig.plugins = webpackConfig.plugins.filter(\n        (p) => (p as any).__next_css_remove !== true\n      )\n    }\n    if (webpackConfig.optimization?.minimizer?.length) {\n      // Disable CSS Minifier\n      webpackConfig.optimization.minimizer =\n        webpackConfig.optimization.minimizer.filter(\n          (e) => (e as any).__next_css_remove !== true\n        )\n    }\n  } else if (!config.future.strictPostcssConfiguration) {\n    await __overrideCssConfiguration(dir, !dev, webpackConfig)\n  }\n\n  // Inject missing React Refresh loaders so that development mode is fast:\n  if (hasReactRefresh) {\n    attachReactRefresh(webpackConfig, defaultLoaders.babel)\n  }\n\n  // check if using @zeit/next-typescript and show warning\n  if (\n    isServer &&\n    webpackConfig.module &&\n    Array.isArray(webpackConfig.module.rules)\n  ) {\n    let foundTsRule = false\n\n    webpackConfig.module.rules = webpackConfig.module.rules.filter(\n      (rule): boolean => {\n        if (!(rule.test instanceof RegExp)) return true\n        if ('noop.ts'.match(rule.test) && !'noop.js'.match(rule.test)) {\n          // remove if it matches @zeit/next-typescript\n          foundTsRule = rule.use === defaultLoaders.babel\n          return !foundTsRule\n        }\n        return true\n      }\n    )\n\n    if (foundTsRule) {\n      console.warn(\n        '\\n@zeit/next-typescript is no longer needed since Next.js has built-in support for TypeScript now. Please remove it from your next.config.js and your .babelrc\\n'\n      )\n    }\n  }\n\n  // Patch `@zeit/next-sass`, `@zeit/next-less`, `@zeit/next-stylus` for compatibility\n  if (webpackConfig.module && Array.isArray(webpackConfig.module.rules)) {\n    ;[].forEach.call(\n      webpackConfig.module.rules,\n      function (rule: webpack.RuleSetRule) {\n        if (!(rule.test instanceof RegExp && Array.isArray(rule.use))) {\n          return\n        }\n\n        const isSass =\n          rule.test.source === '\\\\.scss$' || rule.test.source === '\\\\.sass$'\n        const isLess = rule.test.source === '\\\\.less$'\n        const isCss = rule.test.source === '\\\\.css$'\n        const isStylus = rule.test.source === '\\\\.styl$'\n\n        // Check if the rule we're iterating over applies to Sass, Less, or CSS\n        if (!(isSass || isLess || isCss || isStylus)) {\n          return\n        }\n\n        ;[].forEach.call(rule.use, function (use: webpack.RuleSetUseItem) {\n          if (\n            !(\n              use &&\n              typeof use === 'object' &&\n              // Identify use statements only pertaining to `css-loader`\n              (use.loader === 'css-loader' ||\n                use.loader === 'css-loader/locals') &&\n              use.options &&\n              typeof use.options === 'object' &&\n              // The `minimize` property is a good heuristic that we need to\n              // perform this hack. The `minimize` property was only valid on\n              // old `css-loader` versions. Custom setups (that aren't next-sass,\n              // next-less or next-stylus) likely have the newer version.\n              // We still handle this gracefully below.\n              (Object.prototype.hasOwnProperty.call(use.options, 'minimize') ||\n                Object.prototype.hasOwnProperty.call(\n                  use.options,\n                  'exportOnlyLocals'\n                ))\n            )\n          ) {\n            return\n          }\n\n          // Try to monkey patch within a try-catch. We shouldn't fail the build\n          // if we cannot pull this off.\n          // The user may not even be using the `next-sass` or `next-less` or\n          // `next-stylus` plugins.\n          // If it does work, great!\n          try {\n            // Resolve the version of `@zeit/next-css` as depended on by the Sass,\n            // Less or Stylus plugin.\n            const correctNextCss = require.resolve('@zeit/next-css', {\n              paths: [\n                isCss\n                  ? // Resolve `@zeit/next-css` from the base directory\n                    dir\n                  : // Else, resolve it from the specific plugins\n                    require.resolve(\n                      isSass\n                        ? '@zeit/next-sass'\n                        : isLess\n                        ? '@zeit/next-less'\n                        : isStylus\n                        ? '@zeit/next-stylus'\n                        : 'next'\n                    ),\n              ],\n            })\n\n            // If we found `@zeit/next-css` ...\n            if (correctNextCss) {\n              // ... resolve the version of `css-loader` shipped with that\n              // package instead of whichever was hoisted highest in your\n              // `node_modules` tree.\n              const correctCssLoader = require.resolve(use.loader, {\n                paths: [correctNextCss],\n              })\n              if (correctCssLoader) {\n                // We saved the user from a failed build!\n                use.loader = correctCssLoader\n              }\n            }\n          } catch (_) {\n            // The error is not required to be handled.\n          }\n        })\n      }\n    )\n  }\n\n  // Backwards compat for `main.js` entry key\n  // and setup of dependencies between entries\n  // we can't do that in the initial entry for\n  // backward-compat reasons\n  const originalEntry: any = webpackConfig.entry\n  if (typeof originalEntry !== 'undefined') {\n    const updatedEntry = async () => {\n      const entry: WebpackEntrypoints =\n        typeof originalEntry === 'function'\n          ? await originalEntry()\n          : originalEntry\n      // Server compilation doesn't have main.js\n      if (\n        clientEntries &&\n        Array.isArray(entry['main.js']) &&\n        entry['main.js'].length > 0\n      ) {\n        const originalFile = clientEntries[\n          CLIENT_STATIC_FILES_RUNTIME_MAIN\n        ] as string\n        entry[CLIENT_STATIC_FILES_RUNTIME_MAIN] = [\n          ...entry['main.js'],\n          originalFile,\n        ]\n      }\n      delete entry['main.js']\n\n      if (isWebpack5 && !isServer) {\n        for (const name of Object.keys(entry)) {\n          if (\n            name === 'polyfills' ||\n            name === 'main' ||\n            name === 'amp' ||\n            name === 'react-refresh'\n          )\n            continue\n          const dependOn =\n            name.startsWith('pages/') && name !== 'pages/_app'\n              ? 'pages/_app'\n              : 'main'\n          const old = entry[name]\n          if (typeof old === 'object' && !Array.isArray(old)) {\n            entry[name] = {\n              dependOn,\n              ...old,\n            }\n          } else {\n            entry[name] = {\n              import: old,\n              dependOn,\n            }\n          }\n        }\n      }\n\n      return entry\n    }\n    // @ts-ignore webpack 5 typings needed\n    webpackConfig.entry = updatedEntry\n  }\n\n  if (!dev) {\n    // entry is always a function\n    webpackConfig.entry = await (webpackConfig.entry as webpack.EntryFunc)()\n  }\n\n  return webpackConfig\n}\n"]},"metadata":{},"sourceType":"script"}